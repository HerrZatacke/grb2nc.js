"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[474],{998:(t,r,n)=>{n.d(r,{QN:()=>ei,qg:()=>eW});var i="u">typeof globalThis?globalThis:"u">typeof window?window:"u">typeof global?global:"u">typeof self?self:{},o={};!function(t){var r;r=function(){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n="boolean"==typeof RegExp().sticky;function i(t){return t&&"[object RegExp]"===r.call(t)}function o(t){return t&&"object"==typeof t&&!i(t)&&!Array.isArray(t)}function a(t){return t.length?"(?:"+t.map(function(t){return"(?:"+t+")"}).join("|")+")":"(?!)"}function s(t){if("string"==typeof t)return"(?:"+t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(i(t)){if(t.ignoreCase)throw Error("RegExp /i flag not allowed");if(t.global)throw Error("RegExp /g flag is implied");if(t.sticky)throw Error("RegExp /y flag is implied");if(t.multiline)throw Error("RegExp /m flag is implied");return t.source}throw Error("Not a pattern: "+t)}function l(t,r){return t.length>r?t:Array(r-t.length+1).join(" ")+t}function u(r,n){if(o(n)||(n={match:n}),n.include)throw Error("Matching rules cannot also include states");var a={defaultType:r,lineBreaks:!!n.error||!!n.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var s in n)t.call(n,s)&&(a[s]=n[s]);if("string"==typeof a.type&&r!==a.type)throw Error("Type transform cannot be a string (type '"+a.type+"' for token '"+r+"')");var l=a.match;return a.match=Array.isArray(l)?l:l?[l]:[],a.match.sort(function(t,r){return i(t)&&i(r)?0:i(r)?-1:i(t)?1:r.length-t.length}),a}function c(t){return Array.isArray(t)?function(t){for(var r=[],n=0;n<t.length;n++){var i=t[n];if(i.include){for(var o=[].concat(i.include),a=0;a<o.length;a++)r.push({include:o[a]});continue}if(!i.type)throw Error("Rule has no type: "+JSON.stringify(i));r.push(u(i.type,i))}return r}(t):function(t){for(var r=Object.getOwnPropertyNames(t),n=[],i=0;i<r.length;i++){var a=r[i],s=[].concat(t[a]);if("include"===a){for(var l=0;l<s.length;l++)n.push({include:s[l]});continue}var c=[];s.forEach(function(t){o(t)?(c.length&&n.push(u(a,c)),n.push(u(a,t)),c=[]):c.push(t)}),c.length&&n.push(u(a,c))}return n}(t)}var p=u("error",{lineBreaks:!0,shouldThrow:!0});function f(t,r){for(var o=null,l=Object.create(null),u=!0,c=null,f=[],h=[],d=0;d<t.length;d++)t[d].fallback&&(u=!1);for(var d=0;d<t.length;d++){var y=t[d];if(y.include)throw Error("Inheritance is not allowed in stateless lexers");if(y.error||y.fallback){if(o)throw!y.fallback==!o.fallback?Error("Multiple "+(y.fallback?"fallback":"error")+" rules not allowed (for token '"+y.defaultType+"')"):Error("fallback and error are mutually exclusive (for token '"+y.defaultType+"')");o=y}var m=y.match.slice();if(u)for(;m.length&&"string"==typeof m[0]&&1===m[0].length;)l[m.shift().charCodeAt(0)]=y;if(y.pop||y.push||y.next){if(!r)throw Error("State-switching options are not allowed in stateless lexers (for token '"+y.defaultType+"')");if(y.fallback)throw Error("State-switching options are not allowed on fallback tokens (for token '"+y.defaultType+"')")}if(0!==m.length){u=!1,f.push(y);for(var g=0;g<m.length;g++){var v=m[g];if(i(v)){if(null===c)c=v.unicode;else if(c!==v.unicode&&!1===y.fallback)throw Error("If one rule is /u then all must be")}}var x=a(m.map(s)),b=new RegExp(x);if(b.test(""))throw Error("RegExp matches empty string: "+b);if(RegExp("|"+x).exec("").length-1>0)throw Error("RegExp has capture groups: "+b+`
Use (?: … ) instead`);if(!y.lineBreaks&&b.test(`
`))throw Error("Rule should declare lineBreaks: "+b);h.push("("+x+")")}}var E=o&&o.fallback,_=n&&!E?"ym":"gm";return!0===c&&(_+="u"),{regexp:new RegExp(a(h)+(n||E?"":"|"),_),groups:f,fast:l,error:o||p}}function h(t,r,n){var i=t&&(t.push||t.next);if(i&&!n[i])throw Error("Missing state '"+i+"' (in token '"+t.defaultType+"' of state '"+r+"')");if(t&&t.pop&&1!=+t.pop)throw Error("pop must be 1 (in token '"+t.defaultType+"' of state '"+r+"')")}var d=function(t,r){this.startState=r,this.states=t,this.buffer="",this.stack=[],this.reset()};d.prototype.reset=function(t,r){return this.buffer=t||"",this.index=0,this.line=r?r.line:1,this.col=r?r.col:1,this.queuedToken=r?r.queuedToken:null,this.queuedText=r?r.queuedText:"",this.queuedThrow=r?r.queuedThrow:null,this.setState(r?r.state:this.startState),this.stack=r&&r.stack?r.stack.slice():[],this},d.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},d.prototype.setState=function(t){if(!(!t||this.state===t)){this.state=t;var r=this.states[t];this.groups=r.groups,this.error=r.error,this.re=r.regexp,this.fast=r.fast}},d.prototype.popState=function(){this.setState(this.stack.pop())},d.prototype.pushState=function(t){this.stack.push(this.state),this.setState(t)};var y=n?function(t,r){return t.exec(r)}:function(t,r){var n=t.exec(r);return 0===n[0].length?null:n};function m(){return this.value}if(d.prototype._getGroup=function(t){for(var r=this.groups.length,n=0;n<r;n++)if(void 0!==t[n+1])return this.groups[n];throw Error("Cannot find token type for matched text")},d.prototype.next=function(){var t=this.index;if(this.queuedGroup){var r=this._token(this.queuedGroup,this.queuedText,t);return this.queuedGroup=null,this.queuedText="",r}var n=this.buffer;if(t!==n.length){var i=this.fast[n.charCodeAt(t)];if(i)return this._token(i,n.charAt(t),t);var o=this.re;o.lastIndex=t;var a=y(o,n),s=this.error;if(null==a)return this._token(s,n.slice(t,n.length),t);var i=this._getGroup(a),l=a[0];return s.fallback&&a.index!==t?(this.queuedGroup=i,this.queuedText=l,this._token(s,n.slice(t,a.index),t)):this._token(i,l,t)}},d.prototype._token=function(t,r,n){var i=0;if(t.lineBreaks){var o=/\n/g,a=1;if(r===`
`)i=1;else for(;o.exec(r);)i++,a=o.lastIndex}var s={type:"function"==typeof t.type&&t.type(r)||t.defaultType,value:"function"==typeof t.value?t.value(r):r,text:r,toString:m,offset:n,lineBreaks:i,line:this.line,col:this.col},l=r.length;if(this.index+=l,this.line+=i,0!==i?this.col=l-a+1:this.col+=l,t.shouldThrow)throw Error(this.formatError(s,"invalid syntax"));return t.pop?this.popState():t.push?this.pushState(t.push):t.next&&this.setState(t.next),s},"u">typeof Symbol&&Symbol.iterator){var g=function(t){this.lexer=t};g.prototype.next=function(){var t=this.lexer.next();return{value:t,done:!t}},g.prototype[Symbol.iterator]=function(){return this},d.prototype[Symbol.iterator]=function(){return new g(this)}}return d.prototype.formatError=function(t,r){if(null==t)var n=this.buffer.slice(this.index),t={text:n,offset:this.index,lineBreaks:+(-1!==n.indexOf(`
`)),line:this.line,col:this.col};var i=Math.max(t.line-2,1),o=String(t.line+2).length,a=(function(t,r){for(var n=t.length,i=0;;){var o=t.lastIndexOf(`
`,n-1);if(-1===o||(i++,n=o,i===r)||0===n)break}var a=i<r?0:n+1;return t.substring(a).split(`
`)})(this.buffer,this.line-t.line+2+1).slice(0,5),s=[];s.push(r+" at line "+t.line+" col "+t.col+":"),s.push("");for(var u=0;u<a.length;u++){var c=a[u],p=i+u;s.push(l(String(p),o)+"  "+c),p===t.line&&s.push(l("",o+t.col+1)+"^")}return s.join(`
`)},d.prototype.clone=function(){return new d(this.states,this.state)},d.prototype.has=function(t){return!0},{compile:function(t){return new d({start:f(c(t))},"start")},states:function(t,r){var n=t.$all?c(t.$all):[];delete t.$all;var i=Object.getOwnPropertyNames(t);r||(r=i[0]);for(var o=Object.create(null),a=0;a<i.length;a++){var s=i[a];o[s]=c(t[s]).concat(n)}for(var a=0;a<i.length;a++)for(var s=i[a],l=o[s],u=Object.create(null),p=0;p<l.length;p++){var y=l[p];if(y.include){var m=[p,1];if(y.include!==s&&!u[y.include]){u[y.include]=!0;var g=o[y.include];if(!g)throw Error("Cannot include nonexistent state '"+y.include+"' (in state '"+s+"')");for(var v=0;v<g.length;v++){var x=g[v];-1===l.indexOf(x)&&m.push(x)}}l.splice.apply(l,m),p--}}for(var b=Object.create(null),a=0;a<i.length;a++){var s=i[a];b[s]=f(o[s],!0)}for(var a=0;a<i.length;a++){for(var E=i[a],_=b[E],R=_.groups,p=0;p<R.length;p++)h(R[p],E,b);for(var w=Object.getOwnPropertyNames(_.fast),p=0;p<w.length;p++)h(_.fast[w[p]],E,b)}return new d(b,r)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(t){for(var r="u">typeof Map,n=r?new Map:Object.create(null),i=Object.getOwnPropertyNames(t),o=0;o<i.length;o++){var a=i[o],s=t[a];(Array.isArray(s)?s:[s]).forEach(function(t){if("string"!=typeof t)throw Error("keyword must be string (in keyword '"+a+"')");r?n.set(t,a):n[t]=a})}return function(t){return r?n.get(t):n[t]}}}},t.exports?t.exports=r():i.moo=r()}({get exports(){return o},set exports(e){o=e}});let a=o,s="T_CODE",l="G_CODE",u="M_CODE",c="D_CODE",p="ASTERISK",f="PERCENT",h="EQUALS",d="COMMA",y="OPERATOR",m="GERBER_FORMAT",g="GERBER_UNITS",v="GERBER_TOOL_MACRO",x="GERBER_TOOL_DEF",b="GERBER_LOAD_POLARITY",E="GERBER_LOAD_MIRRORING",_="GERBER_LOAD_ROTATION",R="GERBER_LOAD_SCALING",w="GERBER_STEP_REPEAT",O="GERBER_BLOCK_APERTURE",A="GERBER_MACRO_VARIABLE",k="SEMICOLON",T="DRILL_UNITS",S="DRILL_ZERO_INCLUSION",N="COORD_CHAR",M="NUMBER",C="NEWLINE",B=/^0*/,j=t=>t.replace(B,""),P=t=>{let r=j(t.slice(1));return""===r?"0":r},I={[s]:{match:/T\d+/,value:P},[l]:{match:/G\d+/,value:P},[u]:{match:/M\d+/,value:P},[c]:{match:/D\d+/,value:P},[p]:"*",[f]:"%",[h]:"=",[m]:{match:/FS[ADILT]+/,value:t=>t.slice(2)},[g]:{match:/MO(?:IN|MM)/,value:t=>t.slice(2)},[v]:{match:/AM[$.A-Z_a-z][\w.-]*/,value:t=>t.slice(2)},[x]:{match:/ADD\d+[$.A-Z_a-z][\w.-]*/,value:t=>j(t.slice(3))},[b]:{match:/LP[CD]/,value:t=>t.slice(2)},[E]:{match:/LM(?:XY|[NXY])/,value:t=>t.slice(2)},[_]:{match:/LR[+-]?\d+(?:\.\d+)?/,value:t=>t.slice(2)},[R]:{match:/LS[+-]?\d+(?:\.\d+)?/,value:t=>t.slice(2)},[w]:"SR",[O]:"AB",[A]:/\$\d+/,DEPRECIATED_GERBER_IMAGE_AXES:/AS(?:AXBY|AYBX)/,DEPRECIATED_GERBER_IMAGE_POLARTIY:/IP(?:POS|NEG)/,DEPRECIATED_GERBER_IMAGE_ROTATION:/IR(?:0|90|180|270)/,DEPRECIATED_GERBER_IMAGE_MIRRORING:/MI(?:A[01])?(?:B[01])?/,DEPRECIATED_GERBER_IMAGE_SCALE_FACTOR:/SF(?:A\d+(?:\.\d+)?)?(?:B\d+(?:\.\d+)?)?/,DEPRECIATED_GERBER_IMAGE_OFFSET:/OF(?:A[+-]?\d+(?:\.\d+)?)?(?:B[+-]?\d+(?:\.\d+)?)?/,[k]:";",[T]:/^(?:METRIC|INCH)/,[S]:{match:/,(?:TZ|LZ)/,value:t=>t.slice(1)},[N]:/[A-CFH-JNSX-Z]/,[M]:/[+-]?[\d.]+/,[y]:["x","/","+","-","(",")"],[d]:",",WORD:/[A-Za-z]+/,WHITESPACE:/[\t ]+/,[C]:{match:/\r?\n/,lineBreaks:!0},CATCHALL:/\S/,ERROR:a.error},G="gerber",L="drill",z="leading",D="trailing",$="circle",q="rectangle",F="move",U="TOKEN",H="MIN_TO_MAX";function X(t,r){return{rule:U,type:t,value:r}}function W(t,r){return{rule:U,type:t,value:r,negate:!0}}function Y(t){return{rule:H,min:1,max:1,match:t}}function Z(t){return{rule:H,min:0,max:1,match:t}}function V(t){return{rule:H,min:0,max:1/0,match:t}}function K(t){return{rule:H,min:1,max:1/0,match:t}}function J(t,r,n){return{rule:H,min:t,max:r,match:n}}function Q(t,r){let n=[];for(let i of r){let r=function(t,r){let n=0,i=0,o=0;for(;n<r.length&&i<t.length;){let a=r[n];if(function t(r,n){if(r.rule===U){let t=r.type===n.type,i=null===r.value||void 0===r.value||"string"==typeof r.value&&r.value===n.value||r.value instanceof RegExp&&r.value.test(n.value),o=t&&i;return!0===r.negate?!o:o}return!!Array.isArray(r.match)&&r.match.some(r=>t(r,n))}(a,t[i]))a.rule===U||o>=a.max-1?(n++,i++,o=0):(i++,o++);else{if(a.rule!==H||!(o>=a.min))return"NO_MATCH";o=0,n++}}return n<r.length?et:ee}(t,i.rules);if(r===et)n.push(i);else if(r===ee)return{filetype:i.filetype,nodes:i.createNodes(t)}}return n.length>0?{candidates:n,tokens:t}:{}}let ee="FULL_MATCH",et="PARTIAL_MATCH",er="comment",en="done",ei="units",eo="coordinateFormat",ea="toolDefinition",es="toolChange",el="graphic",eu="interpolateMode";function ec(t){return Object.fromEntries(t.map((r,n)=>[r,n>0?t[n-1]:void 0]).filter(t=>{let[r,n]=t;return r.type===M&&(null==n?void 0:n.type)===N}).map(([t,r])=>[r.value.toLowerCase(),t.value]))}function ep(t){let r=t.filter(t=>t.type===l).map(t=>"0"===t.value?F:"1"===t.value?"line":"2"===t.value?"cwArc":"3"===t.value?"ccwArc":"5"===t.value&&L);return"string"==typeof r[0]?r[0]:void 0}function ef(t){return t.map(t=>t.value).join("").trim()}function eh(t,r={}){let{head:n=t[0],length:i=0}=r,o=i>0?t[t.indexOf(n)+i-1]:t[t.length-1];return{start:{line:n.line,column:n.col,offset:n.offset},end:{line:o.line,column:o.col,offset:o.offset}}}let ed={name:"units",rules:[Y([X(T),X(u,"71"),X(u,"72")]),V([X(d),X(S),X(M,/^0{1,8}\.0{1,8}$/)]),X(C)],createNodes(t){let r="INCH"===t[0].value||"72"===t[0].value?"in":"mm",n=t.filter(t=>t.type===S).map(t=>"LZ"===t.value?D:z),i=t.filter(t=>t.type===M).map(t=>{let[r="",n=""]=t.value.split(".");return[r.length,n.length]}),o=[{type:ei,position:eh(t.slice(0,2)),units:r}];return(n.length>0||i.length>0)&&o.push({type:eo,position:eh(t.slice(1)),mode:void 0,format:i[0],zeroSuppression:n[0]}),o}},ey={name:"tool",rules:[X(s),J(0,12,[X(N,"C"),X(N,"F"),X(N,"S"),X(N,"B"),X(N,"H"),X(N,"Z"),X(M)]),X(C)],createNodes(t){let r=t[0].value,n=eh(t),{c:i}=ec(t.slice(1,-1));return void 0===i?[{type:es,position:n,code:r}]:[{type:ea,shape:{type:$,diameter:Number(i)},hole:void 0,position:n,code:r}]}},em={name:"operationMode",rules:[Y([X(l,"0"),X(l,"1"),X(l,"2"),X(l,"3"),X(l,"5")]),X(C)],createNodes:t=>[{type:eu,position:eh(t),mode:ep(t)}]},eg={name:"operation",rules:[J(0,2,[X(s),X(l,"0"),X(l,"1"),X(l,"2"),X(l,"3"),X(l,"5")]),J(2,8,[X(N),X(M)]),Z([X(s)]),X(C)],createNodes(t){let r=t.filter(t=>t.type===N||t.type===M),n=t.find(t=>t.type===l),i=t.find(t=>t.type===s),o=ec(r),a=null==i?void 0:i.value,u=ep(t),c=eh(t,{head:r[0],length:r.length+1}),p=eh(t,{head:n,length:2}),f=eh(t,{head:i,length:2}),h=[{type:el,position:c,graphic:void 0,coordinates:o}];return void 0!==u&&h.unshift({type:eu,position:p,mode:u}),void 0!==a&&h.unshift({type:es,position:f,code:a}),h}},ev={name:"slot",rules:[J(2,4,[X(N),X(M)]),X(l,"85"),J(2,4,[X(N),X(M)]),X(C)],createNodes(t){let r=t.find(t=>t.type===l),n=void 0===r?-1:t.indexOf(r),i=Object.fromEntries(Object.entries(ec(t.slice(0,n))).map(([t,r])=>[`${t}0`,r])),o=ec(t.slice(n));return[{type:el,position:eh(t),graphic:"slot",coordinates:{...i,...o}}]}},ex={name:"done",rules:[Y([X(u,"30"),X(u,"0")]),X(C)],createNodes:t=>[{type:en,position:eh(t)}]},eb={name:"header",rules:[Y([X(u,"48"),X(f)]),X(C)],createNodes:t=>[{type:"drillHeader",position:eh(t)}]},eE=[ey,em,eg,ev,{name:"comment",rules:[X(k),V([W(C)]),X(C)],createNodes:t=>[{type:er,comment:ef(t.slice(1,-1)),position:eh(t)}]},ed,ex,eb].map(t=>({...t,filetype:L})),e_={name:"macroComment",rules:[X(M,"0"),V([W(p)]),X(p)],createNodes:function(t){let r=t.slice(1,-1).map(t=>t.text).join("").trim();return[{type:"macroComment",position:eh(t),comment:r}]}},eR={name:"macroVariable",rules:[X(A),X(h),K([X(M),X(y),X(A),X(N,"X")]),X(p)],createNodes:function(t){let r=t[0].value,n=ew(t.slice(2,-1));return[{type:"macroVariable",position:eh(t),name:r,value:n}]}};function ew(t){let r=t.map(t=>t.type===N?Object.assign(t,{type:y,value:"x"}):t);return o();function n(){let t=r.shift();if((null==t?void 0:t.type)===M)return Number(t.value);if((null==t?void 0:t.type)===A)return t.value;if((null==t?void 0:t.type)===y&&"-"===t.text)return{left:-1,right:n(),operator:"x"};if((null==t?void 0:t.type)===y&&"+"===t.text)return{left:1,right:n(),operator:"x"};let i=o();return r.shift(),i}function i(){let t=n(),i=r[0];for(;(null==i?void 0:i.type)===y&&("x"===i.value||"/"===i.value);)r.shift(),t={left:t,right:n(),operator:i.value},i=r[0];return t}function o(){let t=i(),n=r[0];for(;(null==n?void 0:n.type)===y&&("+"===n.value||"-"===n.value)||(null==n?void 0:n.type)===M;){let o="+";n.type===y&&(r.shift(),o=n.value),t={left:t,right:i(),operator:o},n=r[0]}return t}}let eO=[{name:"macroPrimitive",rules:[X(M),X(d),K([X(C),X(d),X(M),X(y),X(A),X(N,"X")]),X(p)],createNodes:function(t){let r=t[0].value,n=[[]],i=n[0];for(let r of t.slice(2,-1))r.type===d?(i=[],n.push(i)):i.push(r);let o=n.map(t=>ew(t));return[{type:"macroPrimitive",position:eh(t),code:r,parameters:o}]}},eR,e_],eA=t=>{if(1===t.length){let[r]=t;return{type:$,diameter:r}}if(2===t.length){let[r,n]=t;return{type:q,xSize:r,ySize:n}}},ek={name:"done",rules:[Y([X(u,"0"),X(u,"2")]),X(p)],createNodes:t=>[{type:en,position:eh(t)}]},eT={name:"comment",rules:[X(l,"4"),V([W(p)]),X(p)],createNodes:t=>[{type:er,position:eh(t),comment:ef(t.slice(1,-1))}]},eS={name:"format",rules:[X(f),X(m),V([W(N,"X")]),X(N,"X"),X(M),X(N,"Y"),X(M),V([W(p)]),X(p),J(0,2,[X(g),X(p)]),X(f)],createNodes(t){var r;let n,i,o,a=ec(t),s=t.findIndex(t=>t.type===p),l=t.find(t=>t.type===g);for(let r of t.filter(t=>t.type===m))r.value.includes("T")&&(i=D),r.value.includes("L")&&(i=z),r.value.includes("I")&&(o="incremental"),r.value.includes("A")&&(o="absolute");if(a.x===a.y&&(null==(r=a.x)?void 0:r.length)===2){let t=Number(a.x[0]),r=Number(a.x[1]);t>0&&r>0&&(n=[t,r])}let u=[{type:eo,position:eh(t.slice(1,s+1)),zeroSuppression:i,format:n,mode:o}];return void 0!==l&&u.push({type:ei,position:eh(t.slice(1,-1),{head:l}),units:"MM"===l.value?"mm":"in"}),u}},eN={name:"units",rules:[X(f),X(g),X(p),X(f)],createNodes:t=>[{type:ei,position:eh(t.slice(1,-1)),units:"MM"===t[1].value?"mm":"in"}]},eM={name:"toolMacro",rules:[X(f),X(v),X(p),V([W(f)]),X(f)],createNodes(t){let r=t[1].value;return[{type:"toolMacro",position:eh(t.slice(1,-1)),children:function(t){let r=eO,n=[],i=[];for(let o of t){n.push(o);let t=Q(n,r);void 0!==t.nodes&&i.push(...t.nodes),n=t.tokens??[],r=t.candidates??eO}return i}(t.slice(3,-1)),name:r}]}},eC={name:"toolDefinition",rules:[X(f),X(x),V([X(d),X(M),X(N,"X")]),X(p),X(f)],createNodes(t){let r,n,[,i="",o=""]=/(\d+)(.+)/.exec(t[1].value)??[],a=t.slice(3,-2).filter(t=>t.type===M).map(t=>Number(t.value));switch(o){case"C":{let[t,...i]=a;r={type:$,diameter:t},n=eA(i);break}case"R":case"O":{let[t,i,...s]=a;r={type:"R"===o?q:"obround",xSize:t,ySize:i},n=eA(s);break}case"P":{let[t,i,o,...s]=a;r={type:"polygon",diameter:t,vertices:i,rotation:o},n=eA(s);break}default:r={type:"macroShape",name:o,variableValues:a}}return[{type:ea,position:eh(t.slice(1,-1)),code:i,shape:r,hole:n}]}},eB={name:"toolChange",rules:[Z([X(l,"54")]),X(c),X(p)],createNodes:t=>t.filter(({type:t})=>t===c).map(({value:r})=>({type:es,position:eh(t),code:r}))},ej=t=>{let r=function(t){let r=t.filter(t=>t.type===c).map(t=>"1"===t.value?"segment":"2"===t.value?F:"3"===t.value&&"shape");return"string"==typeof r[0]?r[0]:void 0}(t),n=ec(t),i=ep(t),o=eh(t,{head:void 0===i?t[0]:t[1]}),a=Object.keys(n).length>0||void 0!==r?[{type:el,position:o,graphic:r,coordinates:n}]:[];if(void 0!==i){let r=eh(t,{head:t[0],length:2});a.unshift({type:eu,position:r,mode:i})}return a},eP={name:"operation",rules:[Z([X(l,"1"),X(l,"2"),X(l,"3")]),J(2,8,[X(N),X(M)]),Z([X(c,"1"),X(c,"2"),X(c,"3")]),X(p)],createNodes:ej},eI={name:"operationWithoutCoords",rules:[Z([X(l,"1"),X(l,"2"),X(l,"3")]),Z([X(c,"1"),X(c,"2"),X(c,"3")]),X(p)],createNodes:ej},eG={name:"interpolationMode",rules:[Y([X(l,"1"),X(l,"2"),X(l,"3")]),X(p)],createNodes:t=>[{type:eu,position:eh(t),mode:ep(t)}]},eL={name:"regionMode",rules:[Y([X(l,"36"),X(l,"37")]),X(p)],createNodes:t=>[{type:"regionMode",position:eh(t),region:"36"===t[0].value}]},ez={name:"quadrantMode",rules:[Y([X(l,"74"),X(l,"75")]),X(p)],createNodes:t=>[{type:"quadrantMode",position:eh(t),quadrant:"74"===t[0].value?"single":"multi"}]},eD={name:"loadPolarity",rules:[X(f),X(b),X(p),X(f)],createNodes:t=>[{type:"loadPolarity",position:eh(t.slice(1,-1)),polarity:"D"===t[1].value?"dark":"clear"}]},e$={name:"loadMirroring",rules:[X(f),X(E),X(p),X(f)],createNodes:t=>[{type:"loadMirroring",position:eh(t.slice(1,-1)),mirroring:"N"===t[1].value?"noMirror":"X"===t[1].value?"x":"Y"===t[1].value?"y":"xy"}]},eq={name:"loadRotation",rules:[X(f),X(_),X(p),X(f)],createNodes:t=>[{type:"loadRotation",position:eh(t.slice(1,-1)),rotation:Number(t[1].value)}]},eF={name:"loadScaling",rules:[X(f),X(R),X(p),X(f)],createNodes:t=>[{type:"loadScaling",position:eh(t.slice(1,-1)),scaling:Number(t[1].value)}]},eU={name:"stepRepeat",rules:[X(f),X(w),V([X(N),X(M)]),X(p),X(f)],createNodes(t){let r=ec(t);if(0===Object.keys(r).length)return[{type:"stepRepeatClose"}];let n={i:r.i??"0",j:r.j??"0",x:r.x??"1",y:r.y??"1"};return[{type:"stepRepeatOpen",position:eh(t.slice(1,-1)),stepRepeat:n}]}},eH=[eP,eI,eG,eB,eC,eM,eT,eL,ez,eD,e$,eq,eF,eU,eS,eN,ek,{name:"blockAperture",rules:[X(f),X(O),Z([X(c)]),X(p),X(f)],createNodes:t=>t[2].type===c?[{type:"blockApertureOpen",code:t[2].value}]:[{type:"blockApertureClose"}]},{name:"unimplementedExtendedCommand",rules:[X(f),V([W(f)]),X(f)],createNodes:t=>[{type:"unimplemented",position:eh(t.slice(1,-1)),value:ef(t)}]}].map(t=>({...t,filetype:G})),eX=[...eH,...eE];function eW(t){return(function(){let t=function(){let t=a.compile(I);return{feed:function(r,n){var i;return t.reset(r,n),i=(null==n?void 0:n.offset)??0,{[Symbol.iterator](){return this},next(){let r=t.next();return void 0!==r?{value:[{...r,offset:i+r.offset},{...t.save(),offset:i+(t.index??0)}]}:{value:void 0,done:!0}}}}}}(),r=[],n,i,o="",s={lexer:t,feed:function(a){let l=function(t,r){let n=[],i=l(),o=[],a,s="";for(let[u,c]of t){o.push(u);let t=Q(o,i);void 0===t.nodes?s+=u.text:(n.push(...t.nodes),a=c,s=""),r=r??t.filetype,o=t.tokens??[],i=t.candidates??l()}return{filetype:r,unmatched:s,nodes:n,lexerState:a};function l(){return r===G?eH:r===L?eE:eX}}(t.feed(`${o}${a}`,i),n);for(let t of(n=n??l.filetype,o=l.unmatched,i=l.lexerState??i,l.nodes))r.push(t);return s},result:function(){if(void 0===n)throw Error("File type not recognized");return{type:"root",filetype:n,children:r}}};return s})().feed(t).result()}},1739:(t,r,n)=>{n.d(r,{tW:()=>c});let i=function(){class t{#e=new Map;compare(t,r){let n=typeof t,i=typeof r;return"string"===n&&"string"===i?t.localeCompare(r):"number"===n&&"number"===i?t-r:String.prototype.localeCompare.call(this.serialize(t,!0),this.serialize(r,!0))}serialize(t,r){if(null===t)return"null";switch(typeof t){case"string":return r?t:`'${t}'`;case"bigint":return`${t}n`;case"object":return this.$object(t);case"function":return this.$function(t)}return String(t)}serializeObject(t){let r=Object.prototype.toString.call(t);if("[object Object]"!==r)return this.serializeBuiltInType(r.length<10?`unknown:${r}`:r.slice(8,-1),t);let n=t.constructor,i=n===Object||void 0===n?"":n.name;if(""!==i&&globalThis[i]===n)return this.serializeBuiltInType(i,t);if("function"==typeof t.toJSON){let r=t.toJSON();return i+(null!==r&&"object"==typeof r?this.$object(r):`(${this.serialize(r)})`)}return this.serializeObjectEntries(i,Object.entries(t))}serializeBuiltInType(t,r){let n=this["$"+t];if(n)return n.call(this,r);if("function"==typeof r?.entries)return this.serializeObjectEntries(t,r.entries());throw Error(`Cannot serialize ${t}`)}serializeObjectEntries(t,r){let n=Array.from(r).sort((t,r)=>this.compare(t[0],r[0])),i=`${t}{`;for(let t=0;t<n.length;t++){let[r,o]=n[t];i+=`${this.serialize(r,!0)}:${this.serialize(o)}`,t<n.length-1&&(i+=",")}return i+"}"}$object(t){let r=this.#e.get(t);return void 0===r&&(this.#e.set(t,`#${this.#e.size}`),r=this.serializeObject(t),this.#e.set(t,r)),r}$function(t){let r=Function.prototype.toString.call(t);return"[native code] }"===r.slice(-15)?`${t.name||""}()[native]`:`${t.name}(${t.length})${r.replace(/\s*\n\s*/g,"")}`}$Array(t){let r="[";for(let n=0;n<t.length;n++)r+=this.serialize(t[n]),n<t.length-1&&(r+=",");return r+"]"}$Date(t){try{return`Date(${t.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(t){return`ArrayBuffer[${new Uint8Array(t).join(",")}]`}$Set(t){return`Set${this.$Array(Array.from(t).sort((t,r)=>this.compare(t,r)))}`}$Map(t){return this.serializeObjectEntries("Map",t.entries())}}for(let r of["Error","RegExp","URL"])t.prototype["$"+r]=function(t){return`${r}(${t})`};for(let r of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])t.prototype["$"+r]=function(t){return`${r}[${t.join(",")}]`};for(let r of["BigInt64Array","BigUint64Array"])t.prototype["$"+r]=function(t){return`${r}[${t.join("n,")}${t.length>0?"n":""}]`};return t}(),o=[0x6a09e667,-0x4498517b,0x3c6ef372,-0x5ab00ac6,0x510e527f,-0x64fa9774,0x1f83d9ab,0x5be0cd19],a=[0x428a2f98,0x71374491,-0x4a3f0431,-0x164a245b,0x3956c25b,0x59f111f1,-0x6dc07d5c,-0x54e3a12b,-0x27f85568,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,-0x7f214e02,-0x6423f959,-0x3e640e8c,-0x1b64963f,-0x1041b87a,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,-0x67c1aeae,-0x57ce3993,-0x4ffcd838,-0x40a68039,-0x391ff40d,-0x2a586eb9,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,-0x7e3d36d2,-0x6d8dd37b,-0x5d40175f,-0x57e599b5,-0x3db47490,-0x3893ae5d,-0x2e6d17e7,-0x2966f9dc,-0xbf1ca7b,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,-0x7b3787ec,-0x7338fdf8,-0x6f410006,-0x5baf9315,-0x41065c09,-0x398e870e],s=[];class l{_data=new u;_hash=new u([...o]);_nDataBytes=0;_minBufferSize=0;finalize(t){t&&this._append(t);let r=8*this._nDataBytes,n=8*this._data.sigBytes;return this._data.words[n>>>5]|=128<<24-n%32,this._data.words[(n+64>>>9<<4)+14]=Math.floor(r/0x100000000),this._data.words[(n+64>>>9<<4)+15]=r,this._data.sigBytes=4*this._data.words.length,this._process(),this._hash}_doProcessBlock(t,r){let n=this._hash.words,i=n[0],o=n[1],l=n[2],u=n[3],c=n[4],p=n[5],f=n[6],h=n[7];for(let n=0;n<64;n++){if(n<16)s[n]=0|t[r+n];else{let t=s[n-15],r=(t<<25|t>>>7)^(t<<14|t>>>18)^t>>>3,i=s[n-2],o=(i<<15|i>>>17)^(i<<13|i>>>19)^i>>>10;s[n]=r+s[n-7]+o+s[n-16]}let d=c&p^~c&f,y=i&o^i&l^o&l,m=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),g=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+d+a[n]+s[n],v=m+y;h=f,f=p,p=c,c=u+g|0,u=l,l=o,o=i,i=g+v|0}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+l|0,n[3]=n[3]+u|0,n[4]=n[4]+c|0,n[5]=n[5]+p|0,n[6]=n[6]+f|0,n[7]=n[7]+h|0}_append(t){"string"==typeof t&&(t=u.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let r,n=this._data.sigBytes/64,i=16*(n=t?Math.ceil(n):Math.max((0|n)-this._minBufferSize,0)),o=Math.min(4*i,this._data.sigBytes);if(i){for(let t=0;t<i;t+=16)this._doProcessBlock(this._data.words,t);r=this._data.words.splice(0,i),this._data.sigBytes-=o}return new u(r,o)}}class u{words;sigBytes;constructor(t,r){t=this.words=t||[],this.sigBytes=void 0===r?4*t.length:r}static fromUtf8(t){let r=unescape(encodeURIComponent(t)),n=r.length,i=[];for(let t=0;t<n;t++)i[t>>>2]|=(255&r.charCodeAt(t))<<24-t%4*8;return new u(i,n)}toBase64(){let t=[];for(let r=0;r<this.sigBytes;r+=3){let n=this.words[r>>>2]>>>24-r%4*8&255,i=n<<16|(this.words[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|this.words[r+2>>>2]>>>24-(r+2)%4*8&255;for(let n=0;n<4&&8*r+6*n<8*this.sigBytes;n++)t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(i>>>6*(3-n)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=0xffffffff<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let r=0;r<t.sigBytes;r++){let n=t.words[r>>>2]>>>24-r%4*8&255;this.words[this.sigBytes+r>>>2]|=n<<24-(this.sigBytes+r)%4*8}else for(let r=0;r<t.sigBytes;r+=4)this.words[this.sigBytes+r>>>2]=t.words[r>>>2];this.sigBytes+=t.sigBytes}}function c(t){var r;return r="string"==typeof t?`'${t}'`:new i().serialize(t),new l().finalize(r).toBase64()}},1863:(t,r,n)=>{n.d(r,{p:()=>p});let i=Symbol("Comlink.proxy"),o=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),s=Symbol("Comlink.finalizer"),l=Symbol("Comlink.thrown"),u=t=>"object"==typeof t&&null!==t||"function"==typeof t,c=new Map([["proxy",{canHandle:t=>u(t)&&t[i],serialize(t){let{port1:r,port2:n}=new MessageChannel;return p(t,r),[n,[n]]},deserialize:t=>(t.start(),function(t,r){let n=new Map;return t.addEventListener("message",function(t){let{data:r}=t;if(!r||!r.id)return;let i=n.get(r.id);if(i)try{i(r)}finally{n.delete(r.id)}}),function t(r,n,i=[],s=function(){}){let l=!1,u=new Proxy(s,{get(o,s){if(h(l),s===a)return()=>{m&&m.unregister(u),d(r),n.clear(),l=!0};if("then"===s){if(0===i.length)return{then:()=>u};let t=E(r,n,{type:"GET",path:i.map(t=>t.toString())}).then(b);return t.then.bind(t)}return t(r,n,[...i,s])},set(t,o,a){h(l);let[s,u]=x(a);return E(r,n,{type:"SET",path:[...i,o].map(t=>t.toString()),value:s},u).then(b)},apply(a,s,u){h(l);let c=i[i.length-1];if(c===o)return E(r,n,{type:"ENDPOINT"}).then(b);if("bind"===c)return t(r,n,i.slice(0,-1));let[p,f]=g(u);return E(r,n,{type:"APPLY",path:i.map(t=>t.toString()),argumentList:p},f).then(b)},construct(t,o){h(l);let[a,s]=g(o);return E(r,n,{type:"CONSTRUCT",path:i.map(t=>t.toString()),argumentList:a},s).then(b)}}),c=(y.get(r)||0)+1;return y.set(r,c),m&&m.register(u,r,u),u}(t,n,[],void 0)}(t))}],["throw",{canHandle:t=>u(t)&&l in t,serialize:({value:t})=>[t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[]],deserialize(t){if(t.isError)throw Object.assign(Error(t.value.message),t.value);throw t.value}}]]);function p(t,r=globalThis,n=["*"]){r.addEventListener("message",function o(a){let u;if(!a||!a.data)return;if(!function(t,r){for(let n of t)if(r===n||"*"===n||n instanceof RegExp&&n.test(r))return!0;return!1}(n,a.origin))return void console.warn(`Invalid origin '${a.origin}' for comlink proxy`);let{id:c,type:h,path:d}=Object.assign({path:[]},a.data),y=(a.data.argumentList||[]).map(b);try{var m,g,E;let r=d.slice(0,-1).reduce((t,r)=>t[r],t),n=d.reduce((t,r)=>t[r],t);switch(h){case"GET":u=n;break;case"SET":r[d.slice(-1)[0]]=b(a.data.value),u=!0;break;case"APPLY":u=n.apply(r,y);break;case"CONSTRUCT":m=new n(...y),u=Object.assign(m,{[i]:!0});break;case"ENDPOINT":{let{port1:r,port2:n}=new MessageChannel;p(t,n),g=r,E=[r],v.set(g,E),u=g}break;case"RELEASE":u=void 0;break;default:return}}catch(t){u={value:t,[l]:0}}Promise.resolve(u).catch(t=>({value:t,[l]:0})).then(n=>{let[i,a]=x(n);r.postMessage(Object.assign(Object.assign({},i),{id:c}),a),"RELEASE"===h&&(r.removeEventListener("message",o),f(r),s in t&&"function"==typeof t[s]&&t[s]())}).catch(t=>{let[n,i]=x({value:TypeError("Unserializable return value"),[l]:0});r.postMessage(Object.assign(Object.assign({},n),{id:c}),i)})}),r.start&&r.start()}function f(t){"MessagePort"===t.constructor.name&&t.close()}function h(t){if(t)throw Error("Proxy has been released and is not useable")}function d(t){return E(t,new Map,{type:"RELEASE"}).then(()=>{f(t)})}let y=new WeakMap,m="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{let r=(y.get(t)||0)-1;y.set(t,r),0===r&&d(t)});function g(t){var r;let n=t.map(x);return[n.map(t=>t[0]),(r=n.map(t=>t[1]),Array.prototype.concat.apply([],r))]}let v=new WeakMap;function x(t){for(let[r,n]of c)if(n.canHandle(t)){let[i,o]=n.serialize(t);return[{type:"HANDLER",name:r,value:i},o]}return[{type:"RAW",value:t},v.get(t)||[]]}function b(t){switch(t.type){case"HANDLER":return c.get(t.name).deserialize(t.value);case"RAW":return t.value}}function E(t,r,n,i){return new Promise(o=>{let a=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");r.set(a,o),t.start&&t.start(),t.postMessage(Object.assign({id:a},n),i)})}},7922:(t,r,n)=>{n.d(r,{_:()=>i});function i(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}},9690:(t,r,n)=>{n.d(r,{QI:()=>tA});var i="u">typeof globalThis?globalThis:"u">typeof window?window:"u">typeof global?global:"u">typeof self?self:{},o={};!function(t){var r;r=function(){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n="boolean"==typeof RegExp().sticky;function i(t){return t&&"[object RegExp]"===r.call(t)}function o(t){return t&&"object"==typeof t&&!i(t)&&!Array.isArray(t)}function a(t){return t.length?"(?:"+t.map(function(t){return"(?:"+t+")"}).join("|")+")":"(?!)"}function s(t){if("string"==typeof t)return"(?:"+t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(i(t)){if(t.ignoreCase)throw Error("RegExp /i flag not allowed");if(t.global)throw Error("RegExp /g flag is implied");if(t.sticky)throw Error("RegExp /y flag is implied");if(t.multiline)throw Error("RegExp /m flag is implied");return t.source}throw Error("Not a pattern: "+t)}function l(t,r){return t.length>r?t:Array(r-t.length+1).join(" ")+t}function u(r,n){if(o(n)||(n={match:n}),n.include)throw Error("Matching rules cannot also include states");var a={defaultType:r,lineBreaks:!!n.error||!!n.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var s in n)t.call(n,s)&&(a[s]=n[s]);if("string"==typeof a.type&&r!==a.type)throw Error("Type transform cannot be a string (type '"+a.type+"' for token '"+r+"')");var l=a.match;return a.match=Array.isArray(l)?l:l?[l]:[],a.match.sort(function(t,r){return i(t)&&i(r)?0:i(r)?-1:i(t)?1:r.length-t.length}),a}function c(t){return Array.isArray(t)?function(t){for(var r=[],n=0;n<t.length;n++){var i=t[n];if(i.include){for(var o=[].concat(i.include),a=0;a<o.length;a++)r.push({include:o[a]});continue}if(!i.type)throw Error("Rule has no type: "+JSON.stringify(i));r.push(u(i.type,i))}return r}(t):function(t){for(var r=Object.getOwnPropertyNames(t),n=[],i=0;i<r.length;i++){var a=r[i],s=[].concat(t[a]);if("include"===a){for(var l=0;l<s.length;l++)n.push({include:s[l]});continue}var c=[];s.forEach(function(t){o(t)?(c.length&&n.push(u(a,c)),n.push(u(a,t)),c=[]):c.push(t)}),c.length&&n.push(u(a,c))}return n}(t)}var p=u("error",{lineBreaks:!0,shouldThrow:!0});function f(t,r){for(var o=null,l=Object.create(null),u=!0,c=null,f=[],h=[],d=0;d<t.length;d++)t[d].fallback&&(u=!1);for(var d=0;d<t.length;d++){var y=t[d];if(y.include)throw Error("Inheritance is not allowed in stateless lexers");if(y.error||y.fallback){if(o)throw!y.fallback==!o.fallback?Error("Multiple "+(y.fallback?"fallback":"error")+" rules not allowed (for token '"+y.defaultType+"')"):Error("fallback and error are mutually exclusive (for token '"+y.defaultType+"')");o=y}var m=y.match.slice();if(u)for(;m.length&&"string"==typeof m[0]&&1===m[0].length;)l[m.shift().charCodeAt(0)]=y;if(y.pop||y.push||y.next){if(!r)throw Error("State-switching options are not allowed in stateless lexers (for token '"+y.defaultType+"')");if(y.fallback)throw Error("State-switching options are not allowed on fallback tokens (for token '"+y.defaultType+"')")}if(0!==m.length){u=!1,f.push(y);for(var g=0;g<m.length;g++){var v=m[g];if(i(v)){if(null===c)c=v.unicode;else if(c!==v.unicode&&!1===y.fallback)throw Error("If one rule is /u then all must be")}}var x=a(m.map(s)),b=new RegExp(x);if(b.test(""))throw Error("RegExp matches empty string: "+b);if(RegExp("|"+x).exec("").length-1>0)throw Error("RegExp has capture groups: "+b+`
Use (?: … ) instead`);if(!y.lineBreaks&&b.test(`
`))throw Error("Rule should declare lineBreaks: "+b);h.push("("+x+")")}}var E=o&&o.fallback,_=n&&!E?"ym":"gm";return!0===c&&(_+="u"),{regexp:new RegExp(a(h)+(n||E?"":"|"),_),groups:f,fast:l,error:o||p}}function h(t,r,n){var i=t&&(t.push||t.next);if(i&&!n[i])throw Error("Missing state '"+i+"' (in token '"+t.defaultType+"' of state '"+r+"')");if(t&&t.pop&&1!=+t.pop)throw Error("pop must be 1 (in token '"+t.defaultType+"' of state '"+r+"')")}var d=function(t,r){this.startState=r,this.states=t,this.buffer="",this.stack=[],this.reset()};d.prototype.reset=function(t,r){return this.buffer=t||"",this.index=0,this.line=r?r.line:1,this.col=r?r.col:1,this.queuedToken=r?r.queuedToken:null,this.queuedText=r?r.queuedText:"",this.queuedThrow=r?r.queuedThrow:null,this.setState(r?r.state:this.startState),this.stack=r&&r.stack?r.stack.slice():[],this},d.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},d.prototype.setState=function(t){if(!(!t||this.state===t)){this.state=t;var r=this.states[t];this.groups=r.groups,this.error=r.error,this.re=r.regexp,this.fast=r.fast}},d.prototype.popState=function(){this.setState(this.stack.pop())},d.prototype.pushState=function(t){this.stack.push(this.state),this.setState(t)};var y=n?function(t,r){return t.exec(r)}:function(t,r){var n=t.exec(r);return 0===n[0].length?null:n};function m(){return this.value}if(d.prototype._getGroup=function(t){for(var r=this.groups.length,n=0;n<r;n++)if(void 0!==t[n+1])return this.groups[n];throw Error("Cannot find token type for matched text")},d.prototype.next=function(){var t=this.index;if(this.queuedGroup){var r=this._token(this.queuedGroup,this.queuedText,t);return this.queuedGroup=null,this.queuedText="",r}var n=this.buffer;if(t!==n.length){var i=this.fast[n.charCodeAt(t)];if(i)return this._token(i,n.charAt(t),t);var o=this.re;o.lastIndex=t;var a=y(o,n),s=this.error;if(null==a)return this._token(s,n.slice(t,n.length),t);var i=this._getGroup(a),l=a[0];return s.fallback&&a.index!==t?(this.queuedGroup=i,this.queuedText=l,this._token(s,n.slice(t,a.index),t)):this._token(i,l,t)}},d.prototype._token=function(t,r,n){var i=0;if(t.lineBreaks){var o=/\n/g,a=1;if(r===`
`)i=1;else for(;o.exec(r);)i++,a=o.lastIndex}var s={type:"function"==typeof t.type&&t.type(r)||t.defaultType,value:"function"==typeof t.value?t.value(r):r,text:r,toString:m,offset:n,lineBreaks:i,line:this.line,col:this.col},l=r.length;if(this.index+=l,this.line+=i,0!==i?this.col=l-a+1:this.col+=l,t.shouldThrow)throw Error(this.formatError(s,"invalid syntax"));return t.pop?this.popState():t.push?this.pushState(t.push):t.next&&this.setState(t.next),s},"u">typeof Symbol&&Symbol.iterator){var g=function(t){this.lexer=t};g.prototype.next=function(){var t=this.lexer.next();return{value:t,done:!t}},g.prototype[Symbol.iterator]=function(){return this},d.prototype[Symbol.iterator]=function(){return new g(this)}}return d.prototype.formatError=function(t,r){if(null==t)var n=this.buffer.slice(this.index),t={text:n,offset:this.index,lineBreaks:+(-1!==n.indexOf(`
`)),line:this.line,col:this.col};var i=Math.max(t.line-2,1),o=String(t.line+2).length,a=(function(t,r){for(var n=t.length,i=0;;){var o=t.lastIndexOf(`
`,n-1);if(-1===o||(i++,n=o,i===r)||0===n)break}var a=i<r?0:n+1;return t.substring(a).split(`
`)})(this.buffer,this.line-t.line+2+1).slice(0,5),s=[];s.push(r+" at line "+t.line+" col "+t.col+":"),s.push("");for(var u=0;u<a.length;u++){var c=a[u],p=i+u;s.push(l(String(p),o)+"  "+c),p===t.line&&s.push(l("",o+t.col+1)+"^")}return s.join(`
`)},d.prototype.clone=function(){return new d(this.states,this.state)},d.prototype.has=function(t){return!0},{compile:function(t){return new d({start:f(c(t))},"start")},states:function(t,r){var n=t.$all?c(t.$all):[];delete t.$all;var i=Object.getOwnPropertyNames(t);r||(r=i[0]);for(var o=Object.create(null),a=0;a<i.length;a++){var s=i[a];o[s]=c(t[s]).concat(n)}for(var a=0;a<i.length;a++)for(var s=i[a],l=o[s],u=Object.create(null),p=0;p<l.length;p++){var y=l[p];if(y.include){var m=[p,1];if(y.include!==s&&!u[y.include]){u[y.include]=!0;var g=o[y.include];if(!g)throw Error("Cannot include nonexistent state '"+y.include+"' (in state '"+s+"')");for(var v=0;v<g.length;v++){var x=g[v];-1===l.indexOf(x)&&m.push(x)}}l.splice.apply(l,m),p--}}for(var b=Object.create(null),a=0;a<i.length;a++){var s=i[a];b[s]=f(o[s],!0)}for(var a=0;a<i.length;a++){for(var E=i[a],_=b[E],R=_.groups,p=0;p<R.length;p++)h(R[p],E,b);for(var w=Object.getOwnPropertyNames(_.fast),p=0;p<w.length;p++)h(_.fast[w[p]],E,b)}return new d(b,r)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(t){for(var r="u">typeof Map,n=r?new Map:Object.create(null),i=Object.getOwnPropertyNames(t),o=0;o<i.length;o++){var a=i[o],s=t[a];(Array.isArray(s)?s:[s]).forEach(function(t){if("string"!=typeof t)throw Error("keyword must be string (in keyword '"+a+"')");r?n.set(t,a):n[t]=a})}return function(t){return r?n.get(t):n[t]}}}},t.exports?t.exports=r():i.moo=r()}({get exports(){return o},set exports(e){o=e}});let a="T_CODE",s="G_CODE",l="M_CODE",u="D_CODE",c="ASTERISK",p="PERCENT",f="COMMA",h="OPERATOR",d="GERBER_FORMAT",y="GERBER_UNITS",m="GERBER_MACRO_VARIABLE",g="DRILL_ZERO_INCLUSION",v="COORD_CHAR",x="NUMBER",b="NEWLINE",E=/^0*/,_=t=>t.replace(E,"");t=>t.slice(2),o.error;let R="drill",w="leading",O="trailing",A="circle",k="rectangle",T="obround",S="polygon",N="macroShape",M="shape",C="move",B="segment",j="slot",P="line",I="cwArc",G="ccwArc",L="single",z="dark",D="noMirror",$="TOKEN",q="MIN_TO_MAX";function F(t,r){return{rule:$,type:t,value:r}}function U(t,r){return{rule:$,type:t,value:r,negate:!0}}function H(t){return{rule:q,min:1,max:1,match:t}}function X(t){return{rule:q,min:0,max:1,match:t}}function W(t){return{rule:q,min:0,max:1/0,match:t}}function Y(t){return{rule:q,min:1,max:1/0,match:t}}function Z(t,r,n){return{rule:q,min:t,max:r,match:n}}let V="FULL_MATCH",K="PARTIAL_MATCH",J="comment",Q="done",ee="units",et="coordinateFormat",er="toolDefinition",en="toolMacro",ei="toolChange",eo="loadPolarity",ea="loadMirroring",es="loadRotation",el="loadScaling",eu="graphic",ec="interpolateMode",ep="regionMode",ef="quadrantMode",eh="macroVariable",ed="macroPrimitive";function ey(t){return Object.fromEntries(t.map((r,n)=>[r,n>0?t[n-1]:void 0]).filter(t=>{let[r,n]=t;return r.type===x&&(null==n?void 0:n.type)===v}).map(([t,r])=>[r.value.toLowerCase(),t.value]))}function em(t){let r=t.filter(t=>t.type===s).map(t=>"0"===t.value?C:"1"===t.value?P:"2"===t.value?I:"3"===t.value?G:"5"===t.value&&R);return"string"==typeof r[0]?r[0]:void 0}function eg(t){return t.map(t=>t.value).join("").trim()}function ev(t,r={}){let{head:n=t[0],length:i=0}=r,o=i>0?t[t.indexOf(n)+i-1]:t[t.length-1];return{start:{line:n.line,column:n.col,offset:n.offset},end:{line:o.line,column:o.col,offset:o.offset}}}let ex={name:"units",rules:[H([F("DRILL_UNITS"),F(l,"71"),F(l,"72")]),W([F(f),F(g),F(x,/^0{1,8}\.0{1,8}$/)]),F(b)],createNodes(t){let r="INCH"===t[0].value||"72"===t[0].value?"in":"mm",n=t.filter(t=>t.type===g).map(t=>"LZ"===t.value?O:w),i=t.filter(t=>t.type===x).map(t=>{let[r="",n=""]=t.value.split(".");return[r.length,n.length]}),o=[{type:ee,position:ev(t.slice(0,2)),units:r}];return(n.length>0||i.length>0)&&o.push({type:et,position:ev(t.slice(1)),mode:void 0,format:i[0],zeroSuppression:n[0]}),o}},eb={name:"tool",rules:[F(a),Z(0,12,[F(v,"C"),F(v,"F"),F(v,"S"),F(v,"B"),F(v,"H"),F(v,"Z"),F(x)]),F(b)],createNodes(t){let r=t[0].value,n=ev(t),{c:i}=ey(t.slice(1,-1));return void 0===i?[{type:ei,position:n,code:r}]:[{type:er,shape:{type:A,diameter:Number(i)},hole:void 0,position:n,code:r}]}},eE={name:"operationMode",rules:[H([F(s,"0"),F(s,"1"),F(s,"2"),F(s,"3"),F(s,"5")]),F(b)],createNodes:t=>[{type:ec,position:ev(t),mode:em(t)}]},e_={name:"operation",rules:[Z(0,2,[F(a),F(s,"0"),F(s,"1"),F(s,"2"),F(s,"3"),F(s,"5")]),Z(2,8,[F(v),F(x)]),X([F(a)]),F(b)],createNodes(t){let r=t.filter(t=>t.type===v||t.type===x),n=t.find(t=>t.type===s),i=t.find(t=>t.type===a),o=ey(r),l=null==i?void 0:i.value,u=em(t),c=ev(t,{head:r[0],length:r.length+1}),p=ev(t,{head:n,length:2}),f=ev(t,{head:i,length:2}),h=[{type:eu,position:c,graphic:void 0,coordinates:o}];return void 0!==u&&h.unshift({type:ec,position:p,mode:u}),void 0!==l&&h.unshift({type:ei,position:f,code:l}),h}},eR={name:"slot",rules:[Z(2,4,[F(v),F(x)]),F(s,"85"),Z(2,4,[F(v),F(x)]),F(b)],createNodes(t){let r=t.find(t=>t.type===s),n=void 0===r?-1:t.indexOf(r),i=Object.fromEntries(Object.entries(ey(t.slice(0,n))).map(([t,r])=>[`${t}0`,r])),o=ey(t.slice(n));return[{type:eu,position:ev(t),graphic:j,coordinates:{...i,...o}}]}},ew={name:"done",rules:[H([F(l,"30"),F(l,"0")]),F(b)],createNodes:t=>[{type:Q,position:ev(t)}]},eO={name:"header",rules:[H([F(l,"48"),F(p)]),F(b)],createNodes:t=>[{type:"drillHeader",position:ev(t)}]},eA=[eb,eE,e_,eR,{name:"comment",rules:[F("SEMICOLON"),W([U(b)]),F(b)],createNodes:t=>[{type:J,comment:eg(t.slice(1,-1)),position:ev(t)}]},ex,ew,eO].map(t=>({...t,filetype:R})),ek={name:"macroComment",rules:[F(x,"0"),W([U(c)]),F(c)],createNodes:function(t){let r=t.slice(1,-1).map(t=>t.text).join("").trim();return[{type:"macroComment",position:ev(t),comment:r}]}},eT={name:"macroVariable",rules:[F(m),F("EQUALS"),Y([F(x),F(h),F(m),F(v,"X")]),F(c)],createNodes:function(t){let r=t[0].value,n=eS(t.slice(2,-1));return[{type:eh,position:ev(t),name:r,value:n}]}};function eS(t){let r=t.map(t=>t.type===v?Object.assign(t,{type:h,value:"x"}):t);return o();function n(){let t=r.shift();if((null==t?void 0:t.type)===x)return Number(t.value);if((null==t?void 0:t.type)===m)return t.value;let n=o();return r.shift(),n}function i(){let t=n(),i=r[0];for(;(null==i?void 0:i.type)===h&&("x"===i.value||"/"===i.value);)r.shift(),t={left:t,right:n(),operator:i.value},i=r[0];return t}function o(){let t=i(),n=r[0];for(;(null==n?void 0:n.type)===h&&("+"===n.value||"-"===n.value)||(null==n?void 0:n.type)===x;){let o="+";n.type===h&&(r.shift(),o=n.value),t={left:t,right:i(),operator:o},n=r[0]}return t}}let eN=[{name:"macroPrimitive",rules:[F(x),F(f),Y([F(b),F(f),F(x),F(h),F(m),F(v,"X")]),F(c)],createNodes:function(t){let r=t[0].value,n=[[]],i=n[0];for(let r of t.slice(2,-1))r.type===f?(i=[],n.push(i)):i.push(r);let o=n.map(t=>eS(t));return[{type:ed,position:ev(t),code:r,parameters:o}]}},eT,ek],eM=t=>{if(1===t.length){let[r]=t;return{type:A,diameter:r}}if(2===t.length){let[r,n]=t;return{type:k,xSize:r,ySize:n}}},eC={name:"done",rules:[H([F(l,"0"),F(l,"2")]),F(c)],createNodes:t=>[{type:Q,position:ev(t)}]},eB={name:"comment",rules:[F(s,"4"),W([U(c)]),F(c)],createNodes:t=>[{type:J,position:ev(t),comment:eg(t.slice(1,-1))}]},ej={name:"format",rules:[F(p),F(d),W([U(v,"X")]),F(v,"X"),F(x),F(v,"Y"),F(x),W([U(c)]),F(c),Z(0,2,[F(y),F(c)]),F(p)],createNodes(t){var r;let n,i,o,a=ey(t),s=t.findIndex(t=>t.type===c),l=t.find(t=>t.type===y);for(let r of t.filter(t=>t.type===d))r.value.includes("T")&&(i=O),r.value.includes("L")&&(i=w),r.value.includes("I")&&(o="incremental"),r.value.includes("A")&&(o="absolute");if(a.x===a.y&&(null==(r=a.x)?void 0:r.length)===2){let t=Number(a.x[0]),r=Number(a.x[1]);t>0&&r>0&&(n=[t,r])}let u=[{type:et,position:ev(t.slice(1,s+1)),zeroSuppression:i,format:n,mode:o}];return void 0!==l&&u.push({type:ee,position:ev(t.slice(1,-1),{head:l}),units:"MM"===l.value?"mm":"in"}),u}},eP={name:"units",rules:[F(p),F(y),F(c),F(p)],createNodes:t=>[{type:ee,position:ev(t.slice(1,-1)),units:"MM"===t[1].value?"mm":"in"}]},eI={name:"toolMacro",rules:[F(p),F("GERBER_TOOL_MACRO"),F(c),W([U(p)]),F(p)],createNodes(t){let r=t[1].value;return[{type:en,position:ev(t.slice(1,-1)),children:function(t){let r=eN,n=[],i=[];for(let o of t){n.push(o);let t=function(t,r){let n=[];for(let i of r){let r=function(t,r){let n=0,i=0,o=0;for(;n<r.length&&i<t.length;){let a=r[n];if(function t(r,n){if(r.rule===$){let t=r.type===n.type,i=null===r.value||void 0===r.value||"string"==typeof r.value&&r.value===n.value||r.value instanceof RegExp&&r.value.test(n.value),o=t&&i;return!0===r.negate?!o:o}return!!Array.isArray(r.match)&&r.match.some(r=>t(r,n))}(a,t[i]))a.rule===$||o>=a.max-1?(n++,i++,o=0):(i++,o++);else{if(a.rule!==q||!(o>=a.min))return"NO_MATCH";o=0,n++}}return n<r.length?K:V}(t,i.rules);if(r===K)n.push(i);else if(r===V)return{filetype:i.filetype,nodes:i.createNodes(t)}}return n.length>0?{candidates:n,tokens:t}:{}}(n,r);void 0!==t.nodes&&i.push(...t.nodes),n=t.tokens??[],r=t.candidates??eN}return i}(t.slice(3,-1)),name:r}]}},eG={name:"toolDefinition",rules:[F(p),F("GERBER_TOOL_DEF"),W([F(f),F(x),F(v,"X")]),F(c),F(p)],createNodes(t){let r,n,[,i="",o=""]=/(\d+)(.+)/.exec(t[1].value)??[],a=t.slice(3,-2).filter(t=>t.type===x).map(t=>Number(t.value));switch(o){case"C":{let[t,...i]=a;r={type:A,diameter:t},n=eM(i);break}case"R":case"O":{let[t,i,...s]=a;r={type:"R"===o?k:T,xSize:t,ySize:i},n=eM(s);break}case"P":{let[t,i,o,...s]=a;r={type:S,diameter:t,vertices:i,rotation:o},n=eM(s);break}default:r={type:N,name:o,variableValues:a}}return[{type:er,position:ev(t.slice(1,-1)),code:i,shape:r,hole:n}]}},eL={name:"toolChange",rules:[X([F(s,"54")]),F(u),F(c)],createNodes:t=>t.filter(({type:t})=>t===u).map(({value:r})=>({type:ei,position:ev(t),code:r}))},ez=t=>{let r=function(t){let r=t.filter(t=>t.type===u).map(t=>"1"===t.value?B:"2"===t.value?C:"3"===t.value&&M);return"string"==typeof r[0]?r[0]:void 0}(t),n=ey(t),i=em(t),o=ev(t,{head:void 0===i?t[0]:t[1]}),a=Object.keys(n).length>0||void 0!==r?[{type:eu,position:o,graphic:r,coordinates:n}]:[];if(void 0!==i){let r=ev(t,{head:t[0],length:2});a.unshift({type:ec,position:r,mode:i})}return a},eD={name:"operation",rules:[X([F(s,"1"),F(s,"2"),F(s,"3")]),Z(2,8,[F(v),F(x)]),X([F(u,"1"),F(u,"2"),F(u,"3")]),F(c)],createNodes:ez},e$={name:"operationWithoutCoords",rules:[X([F(s,"1"),F(s,"2"),F(s,"3")]),X([F(u,"1"),F(u,"2"),F(u,"3")]),F(c)],createNodes:ez},eq={name:"interpolationMode",rules:[H([F(s,"1"),F(s,"2"),F(s,"3")]),F(c)],createNodes:t=>[{type:ec,position:ev(t),mode:em(t)}]},eF={name:"regionMode",rules:[H([F(s,"36"),F(s,"37")]),F(c)],createNodes:t=>[{type:ep,position:ev(t),region:"36"===t[0].value}]},eU={name:"quadrantMode",rules:[H([F(s,"74"),F(s,"75")]),F(c)],createNodes:t=>[{type:ef,position:ev(t),quadrant:"74"===t[0].value?L:"multi"}]},eH={name:"loadPolarity",rules:[F(p),F("GERBER_LOAD_POLARITY"),F(c),F(p)],createNodes:t=>[{type:eo,position:ev(t.slice(1,-1)),polarity:"D"===t[1].value?z:"clear"}]},eX={name:"loadMirroring",rules:[F(p),F("GERBER_LOAD_MIRRORING"),F(c),F(p)],createNodes:t=>[{type:ea,position:ev(t.slice(1,-1)),mirroring:"N"===t[1].value?D:"X"===t[1].value?"x":"Y"===t[1].value?"y":"xy"}]},eW={name:"loadRotation",rules:[F(p),F("GERBER_LOAD_ROTATION"),F(c),F(p)],createNodes:t=>[{type:es,position:ev(t.slice(1,-1)),rotation:Number(t[1].value)}]},eY={name:"loadScaling",rules:[F(p),F("GERBER_LOAD_SCALING"),F(c),F(p)],createNodes:t=>[{type:el,position:ev(t.slice(1,-1)),scaling:Number(t[1].value)}]},eZ={name:"stepRepeat",rules:[F(p),F("GERBER_STEP_REPEAT"),W([F(v),F(x)]),F(c),F(p)],createNodes(t){let r=ey(t);if(0===Object.keys(r).length)return[{type:"stepRepeatClose"}];let n={i:r.i??"0",j:r.j??"0",x:r.x??"1",y:r.y??"1"};return[{type:"stepRepeatOpen",position:ev(t.slice(1,-1)),stepRepeat:n}]}};[...[eD,e$,eq,eL,eG,eI,eB,eF,eU,eH,eX,eW,eY,eZ,ej,eP,eC,{name:"blockAperture",rules:[F(p),F("GERBER_BLOCK_APERTURE"),X([F(u)]),F(c),F(p)],createNodes:t=>t[2].type===u?[{type:"blockApertureOpen",code:t[2].value}]:[{type:"blockApertureClose"}]},{name:"unimplementedExtendedCommand",rules:[F(p),W([U(p)]),F(p)],createNodes:t=>[{type:"unimplemented",position:ev(t.slice(1,-1)),value:eg(t)}]}].map(t=>({...t,filetype:"gerber"})),...eA];let eV="imageShape",eK="imagePath",eJ="imageRegion",eQ="line",e0="circle",e1="rectangle",e2="polygon",e3="outline",e4="layeredShape",{PI:e5}=Math,e6=e5/2,e8=3*e6,e7=2*e5;function e9(t){return t>=0&&t<=e7?t:t<0?t+e7:t>e7?t-e7:e9(t)}function te(t){return t>=e6?t-e6:t+e8}function tt(t,r,n=0){let i=n*e5/180,[o,a]=[Math.sin(i),Math.cos(i)],[s,l]=t;return[s*a-l*o+r[0],s*o+l*a+r[1]]}function tr(t,r){return t[0]===r[0]&&t[1]===r[1]}function tn(t){return 0===t.length}function ti(t,r){return tn(t)?r:tn(r)?t:[Math.min(t[0],r[0]),Math.min(t[1],r[1]),Math.max(t[2],r[2]),Math.max(t[3],r[3])]}function to(t){return t.reduce(ti,[])}function ta(t){return t.type===eV?function t(r){switch(r.type){case e0:{let{cx:t,cy:n,r:i}=r;return tl([t,n],i)}case e1:{let{x:t,y:n,xSize:i,ySize:o}=r;return[t,n,t+i,n+o]}case e2:return to(r.points.map(t=>tl(t)));case e3:return ts(r.segments);case e4:return to(r.shapes.filter(({erase:t})=>!0!==t).map(t))}}(t.shape):ts(t.segments,t.type===eK?t.width:void 0)}function ts(t,r=0){let n=r/2,i=[];for(let r of t)if(i.push(r.start,r.end),"arc"===r.type){let{start:t,end:n,center:o,radius:a}=r,s=Math.abs(n[2]-t[2]),[l,u]=n[2]>t[2]?[t[2],n[2]]:[n[2],t[2]];for(let t of(l=e9(l),u=e9(u),[[o[0]+a,o[1]],[o[0],o[1]+a],[o[0]-a,o[1]],[o[0],o[1]-a]]))(l>u||s===e7)&&i.push(t),l=te(l),u=te(u)}return to(i.map(t=>tl(t,n)))}function tl(t,r=0){return[t[0]-r,t[1]-r,t[0]+r,t[1]+r]}Symbol.toStringTag;let tu=/FORMAT={?(\d):(\d)/,tc="simpleTool",tp="macroTool",tf={_currentToolCode:void 0,_toolsByCode:{},_macrosByName:{},use(t){if(t.type===en&&(this._macrosByName[t.name]=t.children),t.type===er){let{code:r,shape:n,hole:i}=t,o=n.type===N?{type:tp,name:n.name,dcode:r,macro:this._macrosByName[n.name]??[],variableValues:n.variableValues}:{type:tc,dcode:r,shape:n,hole:i??void 0};this._toolsByCode[r]=o}return(t.type===er||t.type===ei)&&(this._currentToolCode=t.code),"string"==typeof this._currentToolCode?this._toolsByCode[this._currentToolCode]:void 0}},th={_DEFAULT_ARC_OFFSETS:{i:0,j:0,a:0},_previousPoint:{x:0,y:0},use(t,r){let n=this._DEFAULT_ARC_OFFSETS,i=this._previousPoint,o=i;if(t.type===eu){let{coordinates:a}=t,s=td(a.x0,i.x,r),l=td(a.y0,i.y,r),u=td(a.x,s,r),c=td(a.y,l,r),p=td(a.i,0,r),f=td(a.j,0,r),h=td(a.a,0,r);(i.x!==s||i.y!==l)&&(i={x:s,y:l}),(o.x!==u||o.y!==c)&&(o={x:u,y:c}),(0!==p||0!==f||0!==h)&&(n={i:p,j:f,a:h})}return this._previousPoint=o,{startPoint:i,endPoint:o,arcOffsets:n}}};function td(t,r,n){if("string"!=typeof t)return r;if(t.includes(".")||"0"===t)return Number(t);let{coordinateFormat:i,zeroSuppression:o}=n,[a,s]=i,[l,u]=t.startsWith("+")||t.startsWith("-")?[t[0],t.slice(1)]:["+",t],c=a+s,p=o===O?u.padEnd(c,"0"):u.padStart(c,"0"),f=p.slice(0,a),h=p.slice(a);return Number(`${l}${f}.${h}`)}function ty(t,r){let{x:n,y:i}=r;switch(t.type){case A:{let{diameter:r}=t;return{type:e0,cx:n,cy:i,r:r/2}}case k:case T:{let{xSize:r,ySize:o}=t,a=r/2,s=o/2,l={type:e1,x:n-a,y:i-s,xSize:r,ySize:o};return t.type===T&&(l.r=Math.min(a,s)),l}case S:{let{diameter:r,rotation:o,vertices:a}=t,s=r/2,l=(o??0)*e5/180,u=e7/a;return{type:e2,points:Array.from({length:a}).map((t,r)=>{let o=u*r+l;return[n+s*Math.cos(o),i+s*Math.sin(o)]})}}}}function tm(t){if(t.type===e0){let{cx:r,cy:n,r:i}=t;return[{type:"arc",start:[r+i,n,0],end:[r+i,n,e7],center:[r,n],radius:i}]}if(t.type===e1){let{x:r,y:n,xSize:i,ySize:o,r:a}=t;return a===i/2?[{type:eQ,start:[r+i,n+a],end:[r+i,n+o-a]},{type:"arc",start:[r+i,n+o-a,0],end:[r,n+o-a,e5],center:[r+a,n+o-a],radius:a},{type:eQ,start:[r,n+o-a],end:[r,n+a]},{type:"arc",start:[r,n+a,e5],end:[r+i,n+a,e7],center:[r+a,n+a],radius:a}]:a===o/2?[{type:eQ,start:[r+a,n],end:[r+i-a,n]},{type:"arc",start:[r+i-a,n,-e6],end:[r+i-a,n+o,e6],center:[r+i-a,n+a],radius:a},{type:eQ,start:[r+i-a,n+o],end:[r+a,n+o]},{type:"arc",start:[r+a,n+o,e6],end:[r+a,n,e8],center:[r+a,n+a],radius:a}]:[{type:eQ,start:[r,n],end:[r+i,n]},{type:eQ,start:[r+i,n],end:[r+i,n+o]},{type:eQ,start:[r+i,n+o],end:[r,n+o]},{type:eQ,start:[r,n+o],end:[r,n]}]}return t.type===e2?t.points.map((r,n)=>{let i=n<t.points.length-1?n+1:0;return{type:eQ,start:r,end:t.points[i]}}):t.segments}function tg(t,r,n){return void 0===r?tx(t):function(t,r,n=!1){let{startPoint:i,endPoint:o,arcOffsets:a}=t,s=a.a>0?a.a:(a.i**2+a.j**2)**.5;if(n||a.a>0){if(i.x===o.x&&i.y===o.y)return tx(t);let[n,a,l]=(function(t,r){let{x:n,y:i}=t.startPoint,{x:o,y:a}=t.endPoint,[s,l]=[o-n,a-i],[u,c]=[o+n,a+i],p=Math.sqrt(s**2+l**2);if(r<=p/2)return[{x:n+s/2,y:i+l/2}];let f=Math.sqrt(4*r**2/p**2-1),[h,d]=[u/2,c/2],[y,m]=[l*f/2,s*f/2];return[{x:h+y,y:d-m},{x:h-y,y:d+m}]})(t,s).map(t=>tb(i,o,t,r)).sort(([t,r],[n,i])=>Math.abs(r[2]-t[2])-Math.abs(i[2]-n[2]))[0];return{type:"arc",start:n,end:a,center:l,radius:s}}let l={x:i.x+a.i,y:i.y+a.j},[u,c,p]=tb(i,o,l,r);return{type:"arc",start:u,end:c,center:p,radius:s}}(t,r,n)}function tv(t,r){if((null==r?void 0:r.type)===tc&&r.shape.type===e0)return{type:eK,width:r.shape.diameter,segments:[t]};if((null==r?void 0:r.type)===tc&&r.shape.type===e1){var n;return n=r.shape,{type:eJ,segments:t.type===eQ?function(t,r){let{start:n,end:i}=t,[o,a]=n,[s,l]=i,[u,c]=[r.xSize/2,r.ySize/2],p=Math.atan2(l-a,s-o),[f,h]=[o-u,o+u],[d,y]=[a-c,a+c],[m,g]=[s-u,s+u],[v,x]=[l-c,l+c],b=[];return(b=tr(n,i)||p>=0&&p<e6?[[f,d],[h,d],[g,v],[g,x],[m,x],[f,y]]:p>=e6&&p<=e5?[[h,d],[h,y],[g,x],[m,x],[m,v],[f,d]]:p>=-e5&&p<-e6?[[h,y],[f,y],[m,x],[m,v],[g,v],[h,d]]:[[f,y],[f,d],[m,v],[g,v],[g,x],[h,y]]).map((t,r)=>({type:eQ,start:t,end:b[(r+1)%b.length]}))}(t,n):[]}}}function tx(t){return{type:eQ,start:[t.startPoint.x,t.startPoint.y],end:[t.endPoint.x,t.endPoint.y]}}function tb(t,r,n,i){let o=Math.atan2(t.y-n.y,t.x-n.x),a=Math.atan2(r.y-n.y,r.x-n.x);return"ccw"===i?a=a>o?a:a+e7:o=o>a?o:o+e7,[[t.x,t.y,o],[r.x,r.y,a],[n.x,n.y]]}function tE(t,r){if("number"==typeof t)return t;if("string"==typeof t)return r[t];let n=tE(t.left,r),i=tE(t.right,r);switch(t.operator){case"+":return n+i;case"-":return n-i;case"x":return n*i;case"/":return n/i}}let t_={_currentPath:void 0,_arcDirection:void 0,_ambiguousArcCenter:!1,_regionMode:!1,_defaultGraphic:void 0,plot(t,r,n,i){let o,a=[];t.type!==eu?o=void 0:void 0!==t.graphic?o=t.graphic:void 0!==this._defaultGraphic&&(o=this._defaultGraphic);let s=this._plotCurrentPath(t,r,o);if(void 0!==s&&a.push({...s,polarity:i.polarity,mirror:i.mirror,rotation:i.rotation,scale:i.scale,dcode:void 0}),this._setGraphicState(t),o===M&&(null==r?void 0:r.type)===tc&&a.push({type:eV,shape:function(t,r){let{shape:n,hole:i}=t,o=ty(n,r.endPoint);if(void 0!==i){let t=ty(i,r.endPoint);return{type:e4,shapes:[{type:e3,erase:!1,segments:tm(o)},{type:e3,erase:!0,segments:tm(t)}]}}return o}(r,n),polarity:i.polarity,mirror:i.mirror,rotation:i.rotation,scale:i.scale,dcode:r.dcode,location:[n.endPoint.x,n.endPoint.y]}),o===M&&(null==r?void 0:r.type)===tp&&a.push({type:eV,shape:function(t,r){let n=[],i=Object.fromEntries(t.variableValues.map((t,r)=>[`$${r+1}`,t]));for(let o of t.macro)if(o.type===eh&&(i[o.name]=tE(o.value,i)),o.type===ed){let t=[r.endPoint.x,r.endPoint.y],a=o.parameters.map(t=>tE(t,i));n.push(...function(t,r,n){switch(t){case"1":return[function(t,r){let[n,i,o,a,s]=r,[l,u]=tt([o,a],t,s);return{type:e0,erase:0===n,cx:l,cy:u,r:i/2}}(r,n)];case"20":case"2":return[function(t,r){let[n,i,o,a,s,l,u]=r,[c,p]=[l-a,s-o],f=i/2,h=Math.sqrt(c**2+p**2),[d,y]=[f*c/h,f*p/h];return{type:e2,erase:0===n,points:[[o+d,a-y],[s+d,l-y],[s-d,l+y],[o-d,a+y]].map(r=>tt(r,t,u))}}(r,n)];case"21":return[function(t,r){let[n,i,o,a,s,l]=r,[u,c]=[i/2,o/2];return{type:e2,erase:0===n,points:[[a-u,s-c],[a+u,s-c],[a+u,s+c],[a-u,s+c]].map(r=>tt(r,t,l))}}(r,n)];case"22":return[function(t,r){let[n,i,o,a,s,l]=r;return{type:e2,erase:0===n,points:[[a,s],[a+i,s],[a+i,s+o],[a,s+o]].map(r=>tt(r,t,l))}}(r,n)];case"4":return[function(t,r){let[n,,...i]=r.slice(0,-1),o=r[r.length-1];return{type:e2,erase:0===n,points:i.flatMap((t,r)=>r%2==1?[[i[r-1],t]]:[]).map(r=>tt(r,t,o))}}(r,n)];case"5":return[function(t,r){let n,[i,o,a,s,l,u]=r,c=l/2,p=2*e5/o,f=[];for(n=0;n<o;n++){let r=p*n,i=a+c*Math.cos(r),o=s+c*Math.sin(r);f.push(tt([i,o],t,u))}return{type:e2,erase:0===i,points:f}}(r,n)];case"6":return function(t,r){let n=n=>tt(n,t,r[8]),[i,o,a,s,l,u,c,p]=r,[f,h]=n([i,o]),d=c/2,y=p/2,m=[],g=0,v=a;for(;v>=0&&g<u;){let t=v/2,r=t-s;m.push({r:t,erase:!1}),r>0&&m.push({r:r,erase:!0}),g+=1,v=2*(r-l)}return[...m.flatMap(({r:t,erase:r})=>({type:e0,cx:f,cy:h,r:t,erase:r})),{type:e2,erase:!1,points:[[i-d,o-y],[i+d,o-y],[i+d,o+y],[i-d,o+y]].map(n)},{type:e2,erase:!1,points:[[i-y,o-d],[i+y,o-d],[i+y,o+d],[i-y,o+d]].map(n)}]}(r,n);case"7":return[function(t,r){let[n,i,o,a,s,l]=r,u=tt([n,i],t,l),[c,p]=[o/2,a/2],f=s/2,h=c**2-f**2,d=p**2-f**2,y=Math.sqrt(h),m=d>=0?Math.sqrt(d):f,g=[];for(let r of[0,90,180,270]){let o=[[m,f],[y,f],[f,y],[f,m]].map(t=>tt(t,[n,i],r)).map(r=>tt(r,t,l)),[a,s,h]=tb({x:o[1][0],y:o[1][1]},{x:o[2][0],y:o[2][1]},{x:u[0],y:u[1]},"ccw");if(g.push({type:eQ,start:o[0],end:o[1]},{type:"arc",start:a,end:s,center:h,radius:c},{type:eQ,start:o[2],end:o[3]}),!tr(o[0],o[3])){let[t,r,n]=tb({x:o[3][0],y:o[3][1]},{x:o[0][0],y:o[0][1]},{x:u[0],y:u[1]},"cw");g.push({type:"arc",start:t,end:r,center:n,radius:p})}}return{type:e3,segments:g}}(r,n)]}return[]}(o.code,t,a))}return{type:e4,shapes:n}}(r,n),polarity:i.polarity,mirror:i.mirror,rotation:i.rotation,scale:i.scale,dcode:r.dcode,location:[n.endPoint.x,n.endPoint.y]}),o===B&&this._regionMode&&(this._currentPath=this._currentPath??{segments:[],region:this._regionMode,tool:r},this._currentPath.segments.push(tg(n,this._arcDirection,this._ambiguousArcCenter))),o===B&&!this._regionMode){let t=tv(tg(n,this._arcDirection,this._ambiguousArcCenter),r);void 0!==t&&a.push({...t,polarity:i.polarity,mirror:i.mirror,rotation:i.rotation,scale:i.scale,dcode:null==r?void 0:r.dcode})}if(o===j){let t=tv(tg(n),r);void 0!==t&&a.push({...t,polarity:i.polarity,mirror:i.mirror,rotation:i.rotation,scale:i.scale,dcode:null==r?void 0:r.dcode})}return a},_setGraphicState(t){if(t.type===ec&&(this._arcDirection=tw(t.mode)),t.type===ef&&(this._ambiguousArcCenter=t.quadrant===L),t.type===ep&&(this._regionMode=t.region),t.type===eu)switch(t.graphic){case B:this._defaultGraphic=B;break;case C:this._defaultGraphic=C;break;case M:this._defaultGraphic=M}},_plotCurrentPath(t,r,n){if(void 0!==this._currentPath&&(r!==this._currentPath.tool||t.type===ep||t.type===Q||n===C&&this._currentPath.region||n===M||t.type===eo)){let t=function(t){if(t.length>0)return{type:eJ,segments:t}}(this._currentPath.segments);return this._currentPath=void 0,t}}},tR={_defaultGraphic:M,_ambiguousArcCenter:!0,_setGraphicState(t){if(t.type===ec){let{mode:r}=t;this._arcDirection=tw(r),r===I||r===G||r===P?this._defaultGraphic=B:r===C?this._defaultGraphic=C:this._defaultGraphic=M}if(t.type===eu)return t.graphic??this._defaultGraphic}};function tw(t){return t===G?"ccw":t===I?"cw":void 0}let tO={_currentTransform:{polarity:z,mirror:D,rotation:0,scale:1},use(t){return t.type===ea&&(this._currentTransform.mirror=t.mirroring),t.type===eo&&(this._currentTransform.polarity=t.polarity),t.type===es&&(this._currentTransform.rotation=t.rotation),t.type===el&&(this._currentTransform.scale=t.scaling),this._currentTransform}};function tA(t){let r=function(t){let{children:r}=t,n,i,o,a=0;for(;a<r.length&&(void 0===n||void 0===i||void 0===o);){let t=r[a];switch(t.type){case ee:n=t.units;break;case et:i=t.format??void 0,o=t.zeroSuppression??void 0;break;case eu:{let{coordinates:r}=t;for(let t of Object.values(r)){if(void 0!==o)break;(null==t?void 0:t.endsWith("0"))===!0||(null==t?void 0:t.includes("."))===!0?o=w:(null==t?void 0:t.startsWith("0"))===!0&&(o=O)}break}case J:{let{comment:r}=t,n=tu.exec(r);/suppress trailing/i.test(r)?o=O:/(suppress leading|keep zeros)/i.test(r)&&(o=w),null!==n&&(i=[Number(n[1]),Number(n[2])])}}a+=1}return{units:n??"in",coordinateFormat:i??[2,4],zeroSuppression:o??w}}(t),n=Object.create(tf),i=Object.create(th),o=Object.create(tO),a=function(t){let r=Object.create(t_);return t===R?Object.assign(r,tR):r}(t.filetype),s=[];for(let l of t.children){let t=n.use(l),u=i.use(l,r),c=o.use(l),p=a.plot(l,t,u,c);s.push(...p)}return{type:"image",units:r.units,tools:n._toolsByCode,size:to(s.map(ta)),children:s}}}}]);