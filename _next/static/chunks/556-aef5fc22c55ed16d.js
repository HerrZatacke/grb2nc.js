"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[556],{138:(e,t,s)=>{s.d(t,{J:()=>r,p:()=>a});let a=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;return Math.abs(e.X-t.X)<s&&Math.abs(e.Y-t.Y)<s},r=e=>{if(0===e.length)return[];let t=e.map(e=>[...e]),s=[],r=t.shift();for(;t.length>0;){if(!r)throw Error("No current path");let e=r[0],i=r[r.length-1];if(a(e,i)){s.push(r),r=t.shift();continue}let n=!1;for(let s=0;s<t.length;s++){let l=t[s],h=l[0],o=l[l.length-1];if(a(i,h)?(r.push(...l),n=!0):a(i,o)?(r.push(...l.reverse()),n=!0):a(e,o)?(r.unshift(...l),n=!0):a(e,h)&&(r.unshift(...l.reverse()),n=!0),n){t.splice(s,1);break}}if(!n){s.push(r),r=t.shift();continue}}return r&&s.push(r),s}},556:(e,t,s)=>{s.d(t,{MainProvider:()=>g,O:()=>f});var a=s(5155),r=s(2115),i=s(9605),n=s(1863),l=s(8594),h=s(6444);let o=e=>{switch(e){case h.w.DRILL:return{units:h.W.MILLIMETERS,originOffsetX:"0",originOffsetY:"0",safeHeight:"30.0",clearanceHeight:"1.0",workHeight:"0",cutDepth:"-1.8",stepDepth:"1.0",feedRateXY:"0",plungeSpeed:"25",spindleSpeed:"10000"};case h.w.ISOLATION:return{units:h.W.MILLIMETERS,originOffsetX:"0",originOffsetY:"0",safeHeight:"30.0",clearanceHeight:"1.0",workHeight:"0",cutDepth:"-0.1",stepDepth:"0.1",feedRateXY:"70",plungeSpeed:"70",spindleSpeed:"10000"};case h.w.EDGE_CUT:return{units:h.W.MILLIMETERS,originOffsetX:"0",originOffsetY:"0",safeHeight:"30.0",clearanceHeight:"1.0",workHeight:"0",cutDepth:"-1.8",stepDepth:"0.9",feedRateXY:"60",plungeSpeed:"60",spindleSpeed:"10000"};default:throw Error("Unknown task type: ".concat(e))}},c=()=>({[h.w.DRILL]:o(h.w.DRILL),[h.w.ISOLATION]:o(h.w.ISOLATION),[h.w.EDGE_CUT]:o(h.w.EDGE_CUT)}),u={[h.w.EDGE_CUT]:3,[h.w.DRILL]:2,[h.w.ISOLATION]:1},p=(e,t)=>Math.sign(u[e.type]-u[t.type]),d=(0,r.createContext)(null);function g(e){let{children:t}=e,[o,u]=(0,r.useState)([]),[g,f]=(0,r.useState)(!1),[w,m]=(0,r.useState)(0),[E,S]=(0,r.useState)(0),[M,y]=(0,r.useState)([]),[I,L]=(0,r.useState)(()=>({bottom:-0,left:0,right:-0,top:0})),[C,b]=(0,r.useState)(h.W.MILLIMETERS),[P,k]=(0,r.useState)([]),[T,O]=(0,i.useLocalStorage)("machiningParams",c()),[R,D]=(0,r.useState)(null),[X,_]=(0,r.useState)(""),Y=(0,r.useCallback)((e,t)=>{u(s=>s.map(s=>s.fileName!==e?s:{...s,...t}).sort(p))},[]),A=(0,r.useCallback)(e=>{u([...e].sort(p))},[]),v=(0,r.useCallback)((e,t)=>{let s=T||c(),a={...s[e],...t};O({...s,[e]:a})},[T,O]);(e=>{let{tasks:t,setBusy:a,setRenderedTasks:i,setGlobalBounds:h,setProgress:o,setGlobalError:c,resetGlobalError:u,setGlobalUnits:p}=e,d=(0,r.useRef)(null),g=l.G.getScale();(0,r.useEffect)(()=>{let e=new Worker(s.tu(new URL(s.p+s.u(999),s.b)),{type:void 0}),t=setTimeout(()=>{d.current=(0,n.LV)(e),d.current.setup((0,n.BX)(o),(0,n.BX)(c))},1);return()=>{clearTimeout(t),e.terminate()}},[c,o]),(0,r.useEffect)(()=>{d.current&&t.length&&(o(.001),u(),a(!0),d.current.calculate({tasks:t,scale:g}).then(e=>{let{bounds:t,renderedTasks:s,units:r}=e;h({left:Math.min(t.left,0),top:Math.min(t.top,0),right:Math.max(t.right,0),bottom:Math.max(t.bottom,0)}),p(r),i(s),a(!1)}).catch(e=>{c(e.message)}))},[t,a,g,h,i,o,p,c,u])})({tasks:o,setBusy:f,setRenderedTasks:y,setGlobalBounds:L,setGlobalUnits:b,setGlobalError:(0,r.useCallback)(e=>{k(t=>[...t,e])},[]),resetGlobalError:(0,r.useCallback)(()=>{k([])},[]),setProgress:S});let x=(0,r.useMemo)(()=>({setTasks:A,setBusy:f,setActiveHandles:m,setOperationForm:D,setTaskForm:_,tasks:o,busy:g,progress:E,activeHandles:w,globalErrors:P,updateTask:Y,updateMachiningOperationParams:v,renderedTasks:M,globalBounds:I,globalUnits:C,operationForm:R,taskForm:X,machiningOperations:T}),[A,o,g,E,w,P,Y,v,M,I,C,R,X,T]);return(0,a.jsx)(d.Provider,{value:x,children:t})}let f=()=>{let e=(0,r.useContext)(d);if(!e)throw Error("useMainContext must be used within a MainProvider");return e}},6444:(e,t,s)=>{s.d(t,{W:()=>r,w:()=>a});var a=function(e){return e.ISOLATION="isolation",e.EDGE_CUT="edgecut",e.DRILL="drill",e}({}),r=function(e){return e.MILLIMETERS="mm",e.INCHES="in",e}({})},7512:(e,t,s)=>{s.d(t,{O:()=>r});var a=s(138);let r=e=>{let t=e[0],s=e[e.length-1];return(0,a.p)(t,s)?e:[...e,t]}},8594:(e,t,s)=>{s.d(t,{G:()=>d});var a=s(7922),r=s(7249),i=s(138),n=s(6444),l=s(7512);let h=Math.PI,o=Math.PI/2,c=1.5*Math.PI,u=2*Math.PI;class p{run(e,t){return this.clipper.Clear(),this.edgePolygons=[],this.drillCircles=[],e.children.forEach(e=>{switch(e.type){case"imageShape":this.drawShape(e.shape,t);break;case"imagePath":this.drawPath(e,t);break;case"imageRegion":this.drawRegion(e);break;default:console.error("not implemented type")}}),t===n.w.EDGE_CUT&&(0,i.J)(this.edgePolygons).forEach(e=>{this.addPolygon(e,!0)}),this.finalize(t)}drawShape(e,t){switch(e.type){case"rectangle":{let t=e.x,s=e.y,a=e.xSize,r=e.ySize,i=Math.max(e.r||0,this.minimumRadius),n=this.createArc(t+i,s+i,i,h,c),l=this.createArc(t+a-i,s+i,i,c,u),p=[...n,...l,...this.createArc(t+a-i,s+r-i,i,0,o),...this.createArc(t+i,s+r-i,i,o,h),n[0]];this.addPolygon(p,!1);break}case"circle":{t===n.w.DRILL&&this.drillCircles.push(e);let s=e.cx,a=e.cy,r=e.r,i=this.createArc(s,a,r,0,u);i.push(i[0]),this.addPolygon(i,!1);break}case"polygon":if(e.points&&e.points.length>1){if(!e.points||!e.points.length)return;let t=[];e.points.forEach(e=>{let[s,a]=e;t.push({X:s,Y:a})}),t.push({...t[0]}),t.length>2&&this.addPolygon(t,!1)}break;case"layeredShape":e.shapes&&e.shapes.forEach(e=>this.drawShape(e,t));break;default:console.log('unknown shapetype "'.concat(e.type,'"'),e)}}drawPath(e,t){if(!e.segments||!e.segments.length)return;let s=Math.max(e.width||1);e.segments.forEach(e=>{switch(e.type){case"line":switch(t){case n.w.ISOLATION:{let[t,a]=e.start,[r,i]=e.end,n=Math.atan2(i-a,r-t),l=s/2,h=this.createArc(t,a,l,n+o,n-o+u),c=[...h,...this.createArc(r,i,l,n-o,n+o),h[0]].map(e=>({X:e.X,Y:e.Y}));this.addPolygon(c,!1);break}case n.w.EDGE_CUT:{let[t,s]=e.start,[a,r]=e.end;this.edgePolygons.push([{X:t,Y:s},{X:a,Y:r}])}}break;case"arc":{let[s,a]=e.center,[r,i,l]=e.start,[h,o,c]=e.end,u=[{X:r,Y:i},...this.createArc(s,a,e.radius,l,c),{X:h,Y:o}];switch(t){case n.w.ISOLATION:this.addPolygon(u,!1);break;case n.w.EDGE_CUT:this.edgePolygons.push(u)}}}})}drawRegion(e){if(!e.segments||!e.segments.length)return;let t=[];e.segments.forEach((e,s)=>{0===s&&t.push({X:e.start[0],Y:e.start[1]}),t.push({X:e.end[0],Y:e.end[1]})}),t.push(t[0]),t.length>2&&this.addPolygon(t,!1)}createArc(e,t,s,a,r){let i=Math.max(8,Math.min(Math.pow(2,Math.ceil(Math.log2(Math.abs(r-a)*s/.02))),64)),n=[],l=(r-a)/(i-1);for(let r=0;r<i;r++){let i=a+r*l;n.push({X:e+s*Math.cos(i),Y:t+s*Math.sin(i)})}return n}addPolygon(e,t){new r.Clipper().Clear();let s=e.map(e=>{let{X:t,Y:s}=e;return{X:Math.round(t*this.scale),Y:Math.round(s*this.scale)}});t||r.Clipper.Orientation(s)||s.reverse(),this.clipper.AddPath(s,r.PolyType.ptSubject,!0)}finalize(e){let t=[],s=e===n.w.EDGE_CUT?r.PolyFillType.pftEvenOdd:r.PolyFillType.pftNonZero;return this.clipper.Execute(r.ClipType.ctUnion,t,s,s),{polygons:t.map(l.O),drills:this.drillCircles}}getScale(){return this.scale}constructor(e,t=1){(0,a._)(this,"clipper",new r.Clipper),(0,a._)(this,"edgePolygons",[]),(0,a._)(this,"drillCircles",[]),(0,a._)(this,"scale",0),(0,a._)(this,"minimumRadius",0),(0,a._)(this,"precision",1e4),this.scale=t*this.precision,this.minimumRadius=e}}let d=new p(.05)}}]);