"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{138:(e,t,a)=>{a.d(t,{J:()=>r,p:()=>s});let s=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;return Math.abs(e.X-t.X)<a&&Math.abs(e.Y-t.Y)<a},r=e=>{if(0===e.length)return[];let t=e.map(e=>[...e]),a=[],r=t.shift();for(;t.length>0;){if(!r)throw Error("No current path");let e=r[0],i=r[r.length-1];if(s(e,i)){a.push(r),r=t.shift();continue}let n=!1;for(let a=0;a<t.length;a++){let l=t[a],h=l[0],o=l[l.length-1];if(s(i,h)?(r.push(...l),n=!0):s(i,o)?(r.push(...l.reverse()),n=!0):s(e,o)?(r.unshift(...l),n=!0):s(e,h)&&(r.unshift(...l.reverse()),n=!0),n){t.splice(a,1);break}}if(!n){a.push(r),r=t.shift();continue}}return r&&a.push(r),a}},1285:(e,t,a)=>{a.d(t,{MainProvider:()=>f,O:()=>w});var s=a(5155),r=a(2115),i=a(9605),n=a(1863),l=a(8594);let h=()=>({renderOnlyPaths:!1,useSimpleFileInput:!1});var o=a(6444);let c=e=>{switch(e){case o.wP.DRILL:return{units:o.WU.MILLIMETERS,originOffsetX:"0",originOffsetY:"0",safeHeight:"30.0",clearanceHeight:"1.0",workHeight:"0",cutDepth:"-1.8",stepDepth:"1.0",feedRateXY:"0",plungeSpeed:"150",spindleSpeed:"10000"};case o.wP.ISOLATION:return{units:o.WU.MILLIMETERS,originOffsetX:"0",originOffsetY:"0",safeHeight:"30.0",clearanceHeight:"1.0",workHeight:"0",cutDepth:"-0.1",stepDepth:"0.1",feedRateXY:"80",plungeSpeed:"80",spindleSpeed:"10000"};case o.wP.EDGE_CUT:return{units:o.WU.MILLIMETERS,originOffsetX:"0",originOffsetY:"0",safeHeight:"30.0",clearanceHeight:"1.0",workHeight:"0",cutDepth:"-1.8",stepDepth:"0.9",feedRateXY:"45",plungeSpeed:"40",spindleSpeed:"10000"};default:throw Error("Unknown task type: ".concat(e))}},u=()=>({[o.wP.DRILL]:c(o.wP.DRILL),[o.wP.ISOLATION]:c(o.wP.ISOLATION),[o.wP.EDGE_CUT]:c(o.wP.EDGE_CUT),[o.wP.DRAWING]:c(o.wP.ISOLATION)}),p={[o.wP.ISOLATION]:1,[o.wP.DRILL]:2,[o.wP.EDGE_CUT]:3,[o.wP.DRAWING]:4},g=(e,t)=>Math.sign(p[e.type]-p[t.type]),d=(0,r.createContext)(null);function f(e){let{children:t}=e,[c,p]=(0,r.useState)(0),[f,w]=(0,r.useState)(!1),[P,m]=(0,r.useState)(()=>({bottom:-0,left:0,right:-0,top:0})),[E,S]=(0,r.useState)([]),[I,M]=(0,i.useLocalStorage)("grb2nc.settings",h()),[y,b]=(0,r.useState)(o.WU.MILLIMETERS),[L,O]=(0,i.useLocalStorage)("grb2nc.machiningParams",u()),[T,C]=(0,r.useState)(null),[k,R]=(0,r.useState)(0),[D,A]=(0,r.useState)([]),[X,_]=(0,r.useState)(!1),[N,U]=(0,r.useState)(""),[Y,G]=(0,r.useState)([]),[v,x]=(0,r.useState)([]),H=(0,r.useCallback)((e,t)=>{G(a=>a.map(a=>a.fileName!==e?a:{...a,...t}).sort(g))},[]),W=(0,r.useCallback)((e,t)=>{x(a=>a.map(a=>a.fileName!==e?a:{...a,...t}))},[]),z=(0,r.useCallback)(e=>{G([...e].sort(g))},[]),B=(0,r.useCallback)((e,t)=>{let a=u(),s=L||a,r={...a,...s[e],...t};O({...s,[e]:r})},[L,O]),F=(0,r.useCallback)(e=>{let t=h(),a=I||t;M({...t,...a,...e})},[I,M]);(e=>{let{tasks:t,setBusy:s,setRenderedTasks:i,setGlobalBounds:h,setProgress:o,setGlobalError:c,resetGlobalError:u,setGlobalUnits:p}=e,g=(0,r.useRef)(null),d=l.G.getScale();(0,r.useEffect)(()=>{let e=new Worker(a.tu(new URL(a.p+a.u(999),a.b)),{type:void 0}),t=setTimeout(()=>{g.current=(0,n.LV)(e),g.current.setup((0,n.BX)(o),(0,n.BX)(c))},1);return()=>{clearTimeout(t),e.terminate()}},[c,o]),(0,r.useEffect)(()=>{g.current&&t.length&&(o(.001),u(),s(!0),g.current.calculate({tasks:t,scale:d}).then(e=>{let{bounds:t,renderedTasks:a,units:r}=e;h({left:Math.min(t.left,0),top:Math.min(t.top,0),right:Math.max(t.right,0),bottom:Math.max(t.bottom,0)}),p(r),i(a),s(!1)}).catch(e=>{c(e.message)}))},[u,d,s,h,c,p,o,i,t])})({tasks:Y,visibilities:v,setBusy:w,setRenderedTasks:A,setGlobalBounds:m,setGlobalUnits:b,setGlobalError:(0,r.useCallback)(e=>{S(t=>[...t,e])},[]),resetGlobalError:(0,r.useCallback)(()=>{S([])},[]),setProgress:R});let j=(0,r.useMemo)(()=>({activeHandles:c,busy:f,globalBounds:P,globalErrors:E,globalSettings:I,globalUnits:y,machiningOperations:L,operationForm:T,progress:k,renderedTasks:D,setActiveHandles:p,setBusy:w,setOperationForm:C,setShowSettings:_,setTaskForm:U,setTasks:z,setVisibilities:x,showSettings:X,taskForm:N,tasks:Y,updateGlobalSettings:F,updateMachiningOperationParams:B,updateTaskParams:H,updateVisibility:W,visibilities:v}),[c,f,P,E,I,y,L,T,k,D,z,X,N,Y,F,B,H,W,v]);return(0,s.jsx)(d.Provider,{value:j,children:t})}let w=()=>{let e=(0,r.useContext)(d);if(!e)throw Error("useMainContext must be used within a MainProvider");return e}},6444:(e,t,a)=>{a.d(t,{WU:()=>r,Wd:()=>i,_p:()=>n,wP:()=>s});var s=function(e){return e.ISOLATION="isolation",e.EDGE_CUT="edgecut",e.DRILL="drill",e.DRAWING="drawing",e}({}),r=function(e){return e.MILLIMETERS="mm",e.INCHES="in",e}({}),i=function(e){return e.TOP="top",e.BOTTOM="bottom",e.OTHER="other",e}({}),n=function(e){return e.AREA="area",e.OUTLINE="outline",e}({})},7512:(e,t,a)=>{a.d(t,{O:()=>r});var s=a(138);let r=e=>{let t=e[0],a=e[e.length-1];return(0,s.p)(t,a)?e:[...e,t]}},8594:(e,t,a)=>{a.d(t,{G:()=>g});var s=a(7922),r=a(7249),i=a(138),n=a(6444),l=a(7512);let h=Math.PI,o=Math.PI/2,c=1.5*Math.PI,u=2*Math.PI;class p{run(e,t){return this.clipper.Clear(),this.edgePolygons=[],this.drillCircles=[],e.children.forEach(e=>{switch(e.type){case"imageShape":this.drawShape(e.shape,t);break;case"imagePath":this.drawPath(e,t);break;case"imageRegion":this.drawRegion(e);break;default:console.error("not implemented type")}}),t===n.wP.EDGE_CUT&&(0,i.J)(this.edgePolygons).forEach(e=>{this.addPolygon(e,!0)}),this.finalize(t)}drawShape(e,t){switch(e.type){case"rectangle":{let t=e.x,a=e.y,s=e.xSize,r=e.ySize,i=Math.max(e.r||0,this.minimumRadius),n=this.createArc(t+i,a+i,i,h,c),l=this.createArc(t+s-i,a+i,i,c,u),p=[...n,...l,...this.createArc(t+s-i,a+r-i,i,0,o),...this.createArc(t+i,a+r-i,i,o,h),n[0]];this.addPolygon(p,!1);break}case"circle":{t===n.wP.DRILL&&this.drillCircles.push(e);let a=e.cx,s=e.cy,r=e.r,i=this.createArc(a,s,r,0,u);i.push(i[0]),this.addPolygon(i,!1);break}case"polygon":if(e.points&&e.points.length>1){if(!e.points||!e.points.length)return;let t=[];e.points.forEach(e=>{let[a,s]=e;t.push({X:a,Y:s})}),t.push({...t[0]}),t.length>2&&this.addPolygon(t,!1)}break;case"layeredShape":e.shapes&&e.shapes.forEach(e=>this.drawShape(e,t));break;default:console.log('unknown shapetype "'.concat(e.type,'"'),e)}}drawPath(e,t){if(!e.segments||!e.segments.length)return;let a=Math.max(e.width||1);e.segments.forEach(e=>{switch(e.type){case"line":switch(t){case n.wP.ISOLATION:{let[t,s]=e.start,[r,i]=e.end,n=Math.atan2(i-s,r-t),l=a/2,h=this.createArc(t,s,l,n+o,n-o+u),c=[...h,...this.createArc(r,i,l,n-o,n+o),h[0]].map(e=>({X:e.X,Y:e.Y}));this.addPolygon(c,!1);break}case n.wP.EDGE_CUT:{let[t,a]=e.start,[s,r]=e.end;this.edgePolygons.push([{X:t,Y:a},{X:s,Y:r}])}}break;case"arc":{let[a,s]=e.center,[r,i,l]=e.start,[h,o,c]=e.end,u=[{X:r,Y:i},...this.createArc(a,s,e.radius,l,c),{X:h,Y:o}];switch(t){case n.wP.ISOLATION:this.addPolygon(u,!1);break;case n.wP.EDGE_CUT:this.edgePolygons.push(u)}}}})}drawRegion(e){if(!e.segments||!e.segments.length)return;let t=[];e.segments.forEach((e,a)=>{0===a&&t.push({X:e.start[0],Y:e.start[1]}),t.push({X:e.end[0],Y:e.end[1]})}),t.push(t[0]),t.length>2&&this.addPolygon(t,!1)}createArc(e,t,a,s,r){let i=Math.max(8,Math.pow(2,Math.ceil(Math.log2(Math.abs(r-s)*a*25)))),n=[],l=(r-s)/(i-1);for(let r=0;r<i;r++){let i=s+r*l;n.push({X:e+a*Math.cos(i),Y:t+a*Math.sin(i)})}return n}addPolygon(e,t){new r.Clipper().Clear();let a=e.map(e=>{let{X:t,Y:a}=e;return{X:Math.round(t*this.scale),Y:Math.round(a*this.scale)}});t||r.Clipper.Orientation(a)||a.reverse(),this.clipper.AddPath(a,r.PolyType.ptSubject,!0)}finalize(e){let t=[],a=e===n.wP.EDGE_CUT?r.PolyFillType.pftEvenOdd:r.PolyFillType.pftNonZero;return this.clipper.Execute(r.ClipType.ctUnion,t,a,a),{polygons:t.map(l.O),drills:this.drillCircles}}getScale(){return this.scale}constructor(e,t=1){(0,s._)(this,"clipper",new r.Clipper),(0,s._)(this,"edgePolygons",[]),(0,s._)(this,"drillCircles",[]),(0,s._)(this,"scale",0),(0,s._)(this,"minimumRadius",0),(0,s._)(this,"precision",1e4),this.scale=t*this.precision,this.minimumRadius=e}}let g=new p(.05)}}]);